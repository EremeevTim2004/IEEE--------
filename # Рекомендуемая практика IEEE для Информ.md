# Рекомендуемая практика IEEE для Информационные технологии — Телекоммуникации и обмен информацией между системами — Локальные и городские сети — Особые требования. Часть 15.5: Возможности ячеистой топологии в беспроводных персональных сетях (WPAN)

**Аннотация**: Эта рекомендуемая практика IEEE определяет архитектурную структуру, которая позволяет устройствам WPAN продвигать совместимые, стабильные и масштабируемые беспроводные топологии сетки и, при необходимости, предоставлять текст поправки к текущим стандартам WPAN, который требуется для реализации этой рекомендуемой практики.

**Ключевые слова**: назначение адреса, адресация блоков, широковещательная передача, множественный доступ с контролем несущей/предотвращение коллизий, высокоскоростная сетка WPAN, сетка HR-WPAN, многоадресная передача, низкоскоростная сетка WPAN, сетка LR-WPAN, сетка, координатор сетки, маршрутизация сервера, интервал пробуждения, многоадресный переход, многоадресный переход, локальное состояние канала, логическое дерево, портативный, портативность, энергосбережение, надежная трансляция, сенсорная сеть, трассировка маршрута, одноадресная передача, беспроводная PAN, WPAN

Документы стандартов IEEE разрабатываются в рамках обществ IEEE и комитетов по координации стандартов Совета по стандартам Ассоциации стандартов IEEE (IEEE-SA). IEEE разрабатывает свои стандарты посредством процесса разработки консенсуса, одобренного Американским национальным институтом стандартов, который объединяет добровольцев, представляющих различные точки зрения и интересы, для достижения конечного продукта. Добровольцы не обязательно являются членами Института и работают без компенсации. Хотя IEEE администрирует процесс и устанавливает правила для обеспечения справедливости в процессе разработки консенсуса, IEEE не оценивает, не тестирует и не проверяет независимо точность любой информации или обоснованность любых суждений, содержащихся в его стандартах.

Использование стандарта IEEE является полностью добровольным. IEEE отказывается от ответственности за любые телесные повреждения, ущерб имуществу или иной ущерб любого характера, будь то особый, косвенный, вытекающий или компенсационный, прямо или косвенно вытекающий из публикации, использования или опоры на этот или любой другой документ стандарта IEEE.

IEEE не гарантирует и не представляет точность или содержание материала, содержащегося в настоящем документе, и прямо отказывается от любых явных или подразумеваемых гарантий, включая любые подразумеваемые гарантии товарной пригодности или пригодности для определенной цели, или того, что использование материала, содержащегося в настоящем документе, не нарушает патентных прав. Документы стандартов IEEE поставляются «КАК ЕСТЬ».

Существование стандарта IEEE не означает, что нет других способов производить, тестировать, измерять, приобретать, продавать или предоставлять другие товары и услуги, относящиеся к области действия стандарта IEEE. Кроме того, точка зрения, выраженная во время утверждения и выпуска стандарта, может меняться в зависимости от развития уровня техники и комментариев, полученных от пользователей стандарта. Каждый стандарт IEEE пересматривается не реже одного раза в пять лет для пересмотра или повторного подтверждения. Если документу более пяти лет, и он не был повторно подтвержден, разумно сделать вывод, что его содержание, хотя и все еще представляет определенную ценность, не полностью отражает текущее состояние техники. Пользователям рекомендуется проверить, чтобы определить, что у них есть последняя редакция любого стандарта IEEE.

Публикуя и предоставляя этот документ, IEEE не предлагает и не оказывает профессиональных или иных услуг для или от имени какого-либо лица или организации. IEEE также не обязуется выполнять какие-либо обязанности, которые несет какое-либо другое лицо или организация по отношению к другому. Любое лицо, использующее этот и любой другой документ стандартов IEEE, должно полагаться на свое независимое суждение при осуществлении разумной осторожности в любых данных обстоятельствах или, в зависимости от обстоятельств, обращаться за советом к компетентному специалисту для определения уместности данного стандарта IEEE.

**Интерпретации**: Иногда могут возникать вопросы относительно значения частей стандартов, поскольку они относятся к конкретным приложениям. Когда необходимость в интерпретациях доводится до сведения IEEE, Институт инициирует действия по подготовке соответствующих ответов. Поскольку стандарты IEEE представляют собой консенсус заинтересованных сторон, важно гарантировать, что любая интерпретация также получила согласие баланса интересов. По этой причине IEEE и члены его обществ и комитетов по координации стандартов не могут предоставить мгновенный ответ на запросы на интерпретацию, за исключением тех случаев, когда вопрос ранее был официально рассмотрен. Заявление, письменное или устное, которое не обработано в соответствии с Руководством по работе Совета по стандартам IEEE-SA, не должно считаться официальной позицией IEEE или любого из его комитетов и не должно считаться и не должно использоваться как официальное толкование IEEE. На лекциях, симпозиумах, семинарах или образовательных курсах лицо, представляющее информацию о стандартах IEEE, должно ясно дать понять, что его или ее взгляды следует считать личными взглядами этого лица, а не официальной позицией, объяснением или интерпретацией IEEE.

Комментарии по пересмотру стандартов IEEE приветствуются от любой заинтересованной стороны, независимо от членской принадлежности к IEEE. Предложения по изменениям в документах должны быть в форме предлагаемого изменения текста вместе с соответствующими поддерживающими комментариями. Комментарии по стандартам и запросы на толкование следует направлять по следующему адресу:

Секретарь, Совет по стандартам IEEE-SA
445 Hoes Lane
Пискатауэй, Нью-Джерси 08854
США

Разрешение на фотокопирование частей любого отдельного стандарта для внутреннего или личного использования предоставляется Институтом инженеров по электротехнике и электронике, Inc., при условии уплаты соответствующей пошлины в Центр по проверке авторских прав. Чтобы организовать оплату лицензионного сбора, свяжитесь с Центром по проверке авторских прав, Служба поддержки клиентов, 222 Rosewood Drive, Danvers, MA 01923, США; +1 978 750 8400. Разрешение на фотокопирование частей любого отдельного стандарта для использования в учебных классах также можно получить через Центр по проверке авторских прав.

## Введение

Это введение не является частью IEEE Std 802.15.5-2009, IEEE Рекомендуемая практика для информационных технологий — Телекоммуникации и обмен информацией между системами — Локальные и городские сети — Специальные требования.

Эта рекомендуемая практика обеспечивает архитектурную структуру, позволяющую устройствам WPAN продвигать совместимые, стабильные и масштабируемые беспроводные сетчатые топологии. Эта рекомендуемая практика состоит из двух частей: низкоскоростная сетка WPAN и высокоскоростная сетка WPAN. Низкоскоростная сетка построена на IEEE 802.15.4 MAC, в то время как высокоскоростная сетка использует IEEE 802.15.3/3b MAC. Общие функции обеих сеток включают инициализацию сети, адресацию и многоадресную одноадресную передачу. Кроме того, низкоскоростная сетка поддерживает многоадресную передачу, надежное вещание, поддержку переносимости, трассировку маршрута и функцию энергосбережения, а высокоскоростная сетка поддерживает многоадресное обслуживание с гарантией времени.

## Уведомление для пользователей

### Законы и правила

Пользователи этих документов должны ознакомиться со всеми применимыми законами и правилами. Соблюдение положений настоящего стандарта не подразумевает соблюдения каких-либо применимых нормативных требований. Исполнители стандарта несут ответственность за соблюдение или ссылку на применимые нормативные требования. IEEE, публикуя свои стандарты, не намеревается призывать к действиям, которые не соответствуют применимым законам, и эти документы не могут быть истолкованы как таковые.

### Авторские права

Этот документ защищен авторским правом IEEE. Он доступен для широкого круга как государственных, так и частных целей. Сюда входит как использование посредством ссылки в законах и нормативных актах, так и использование в частном саморегулировании, стандартизации и продвижении инженерных практик и методов. Предоставляя этот документ для использования и принятия государственными органами и частными пользователями, IEEE не отказывается от никаких прав на авторское право на этот документ.

### Обновление документов IEEE

Пользователи стандартов IEEE должны знать, что эти документы могут быть заменены в любое время выпуском новых изданий или могут время от времени изменяться посредством выпуска поправок, исправлений или опечаток. Официальный документ IEEE в любой момент времени состоит из текущей редакции документа вместе с любыми поправками, исправлениями или опечатками, действующими на тот момент. Чтобы определить, является ли данный документ текущей редакцией и был ли он изменен посредством выпуска поправок, исправлений или опечаток, посетите веб-сайт Ассоциации стандартов IEEE по адресу <http://ieeexplore.ieee.org/xpl/standards.jsp> или свяжитесь с IEEE по указанному ранее адресу.

Для получения дополнительной информации об Ассоциации стандартов IEEE или процессе разработки стандартов IEEE посетите веб-сайт IEEE-SA по адресу <http://standards.ieee.org>.

### Опечатки

Опечатки, если таковые имеются, для этого и всех других стандартов можно найти по следующему URL: <http://standards.ieee.org/reading/ieee/updates/errata/index.html>. Пользователям рекомендуется периодически проверять этот URL на наличие опечаток.

### Интерпретации

Текущие интерпретации доступны по следующему URL-адресу: <http://standards.ieee.org/reading/ieee/interp/index.html>.

### Патенты

Обращаем внимание на возможность того, что реализация этой рекомендуемой практики может потребовать использования предмета, защищенного патентными правами. Публикация этой рекомендуемой практики не принимает никакой позиции в отношении существования или действительности любых патентных прав в связи с этим. IEEE не отвечает за определение основных патентных претензий, для которых может потребоваться лицензия, за проведение расследований юридической действительности или объема патентных претензий или определение того, являются ли какие-либо лицензионные условия или условия, предоставленные в связи с подачей гарантийного письма, если таковые имеются, или в любых лицензионных соглашениях, разумными или недискриминационными. Пользователям этой рекомендуемой практики прямо уведомляется, что определение действительности любых патентных прав и риска нарушения таких прав является полностью их собственной ответственностью. Дополнительную информацию можно получить в Ассоциации стандартов IEEE.

### Участники

На момент завершения этой рекомендуемой практики в состав рабочей группы IEEE P802.15 входили следующие должностные лица:

* Доктор Роберт Ф. Хейл, председатель рабочей группы
* Рик Альфвин, заместитель председателя рабочей группы
* Патрик Кинни, заместитель председателя и секретарь рабочей группы
* Доктор Джеймс П. К. Гилб, технический редактор рабочей группы
* Доктор Джон Барр, казначей рабочей группы

На момент завершения этой рекомендуемой практики в состав рабочей группы IEEE P802.15 входили следующие должностные лица:

* Доктор Мён Джонг Ли, председатель целевой группы 5
* Доктор Хо-ин Чон, заместитель председателя целевой группы 5
* Доктор Тэ Рим Пак, секретарь целевой группы 5
* Доктор Чунхуэй (Аллан) Чжу, редактор низкой ставки целевой группы 5
* Доктор Сан Сон Чой, редактор высокой ставки целевой группы 5

Автор Астрин, Тэхан Бэ, Джей Бэйн, Гэл Бэссон, Тунцер Байкас, Фил Бичер, Брюс Боско, Андре Бурду, Пэт Карсон, Филипп Шамбелен, Хуор-Синь Чанг, Чанг-Сун Чой, Карлос Кордейро, Алексей Давыдов, Хендрикус Де Рюйтер, Пол Диксон, Кай Домбровски, Джон Дорси, Бас Дрисен, Амаль Экбал, Йоси Эрлих, Роберт Фанфелле, Джон Фарсероту, Рид Фишер, Ёсицугу Фудзита, Киёси Фукуи, Сигэру Фукунага, Рюхэй Фунада, Уланд Гебель, Пол Гордей, Гирирадж Гоял, Экхард Грасс, Марк Гродзинский, Вивек Гупта, Роберт Холл, Кристофер Дж. Хансен, Синсуке Хара, Хироши Харада, Сокдок Хонг, Тянь-Вэй Хуан, Ичиро Ида, Хидето Икеда, Тэцуши Икегами, Акио Исо, Бомджин Чон, Ён-Э Чжон, Сон-Сун Джу, Чол Су Кан, Тэ-Гю Кан, Ясунао Катаяма, Сюдзо Като, Ясутака Кавамото, Стюарт Керри, Джехва Ким, Джэ-Хён Ким, Джинкён Ким, Кихонг Ким, Кёнпё Ким, Сон Ким, Ёнсун Ким, Рёта Кимура, Курсат Кимьяджиоглу, Рюдзи Коно, Фумихидэ Кодзима, Эдвин Квон, Хёнджин Квон, Исмаил Лаккис, Джон Лампе, Чжоу Лан, Джэ Ли, Чон Ли, Мён Ли, Сон Хи Ли, Тэхун Ли, Уён Ли, Чжундин Лэй, Дэниел Льюис, Хуан-Банг Ли, Лян Ли, Шеунг Ли, Юн Лю, Александр Мальцев, Эбби Мэтью, Тайсуке Мацумото, Майкл Макиннис, Майкл Маклафлин, Клаус Мейер, Дино Миниутти, Раджендра Мурти, Хорхе Мышне, Юкимаса Нагай, Кен Наганума, Чиу Нго, Пол Николич, Ёсинори Нисигути, Хиройо Огава, Джисон О, Лоран Уври, Паскаль Пагани, Пак Тэ Рим, Маулин Патель, Стефан Пинель, Фрэнк Погель, Стивен Поуп, Клинтон Пауэлл, Чанг У Пё, Сянпин Цинь, Иван Рид, Ричард Робертс, Бенджамин А. Рольф, Али Садри, Кацуёси Сато, Хирокадзу Савада, Кямран Сайрафян, Майкл Шмидт, Жан Шверер, Хуай-Ронг Шао, Стивен Шеллхаммер, Сюсаку Симада, Юкихиро Симаката, Чанг Суб Шин, Майкл Сим, Харкират Сингх, Карл Стивенсон, Пол Штраух, Чин Сум, Казуаки Такахаши, Кеничи Такидзава, Арно Тоннер, Ичихико Тойода, Джейсон Трачевски, Соломон Трейнин, Альберто Вальдес Гарсия, Магнус Виклунд, Джеральд Вайнингер, Людвиг Винкель, Ын Тэ Вон, Чонын Вон, Пэнфэй Ся, Камья Яздандуст, Джеймс Йи, Каору Ёкоо, Су Ён, Чжан Юй, Бинь Чжэнь, Чуньхуэй Чжу, Джеймс Аллен, Джей Бэйн, Фил Бичер, Джон Бут, Исикава Тиаки, Сунгрэ Чо, Санг Сунг Чой, Вонсук Чой, Чун-Тин Чжоу, Фрэнсис даКоста, Клаус Фосмарк, Джеймс П.К. Гилб, Уланд Гебель, Гвидо Р. Хиерц, Хо-Ин Чон, Ён-Э Чон, Сон-Сун Джу, Хакён Чон, Патрик Кинни, Сондже Квон, Инхван Ли, Мён Джон Ли, Сон-хи Ли, Юн Лю, Себастьян Макс, Клаус Мейер, Лайхёк Пак, Сон-У Пак, Фрэнк Пёгель, Ханс-Юрген Роймерман, Сон Хён Ри, Бенджамин А. Рольфе, Михаэль Шмидт, Хуай-Ронг Шао, Чанг Суб Шин, Майкл Сим, Маркус Вонг, Джун Юн, Руй Чжан, Цзяньлян Чжэн, Чуньхуэй Чжу

Следующие члены индивидуального комитета по голосованию проголосовали за эту рекомендуемую практику. Участники голосования могли проголосовать за одобрение, неодобрение или воздержание.

Ричард Альфвин, Джеймс Аллен, Данило Антонелли, Филип Бичер, Лайл Буллок, Уильям Берд, Джеймс Карло, Санг Санг Чой, Кит Чоу, Чарльз Кук, Тодор Куклев, Томас Динин, Соурав Дутта, Пол Истман, Ричард Эккард, Марк Эммельманн, Авраам Фридман, Девон Гейл, Джеймс П.К. Гилб, Рэндалл Гроувс, К. Гай, Райнер Хач, Джон Хокинс, Марко Эрнандес, Ацуши Ито, Бомджин Чон, Ён Э Чон, Бобби Хосе, Каку, Шинкё, Стюарт Дж. Керри, Ёнбум Ким, Патрик Кинни, Сис Клик, Джозеф Кюблер, Мён Чон Ли, Сон Хи Ли, Ян-Рэй Ляо, Артур Лайт, Уильям Лампкинс, Питер Мартини, Майкл Макиннис, Уэйд Мидкифф, Авигдор Мойсе, Хироюки Накасе, Майкл С. Ньюман, Чарльз Нгете, Джон Нотор, Сатоши Обара, Кнут Одман, Окунду Омени, Сатоши Оям, Тае Рим Пак, Эльдад Перахия, Суббуражан Поннусвами, Клинтон Пауэлл, Роберт Робинсон, Бенджамин Рольф, Сигэнобу Сасаки, Питер Сондерсон, Бартьен Сайого, Чанг Суб Шин, Капил Суд, Амджад Сумро, Томас Старай, Рене Струик, Уолтер Штрупплер, Марк Стурза, Томас Туллиа, Дмитрий Варсанофьев, Прабод Варшни, Стэнли Ван, Андреас Вольф, Пол Уорк, Орен Юэнь, Вэньхао Чжу, Хуан Зунига

Когда Совет по стандартам IEEE-SA одобрил эту рекомендуемую практику 19 марта 2009 года, в его состав входили следующие лица:

* Роберт М. Гроу, председатель
* Томас Превост, заместитель председателя
* Стив М. Миллс, бывший председатель
* Джудит Горман, секретарь

Джон Барр, Карен Бартлесон, Виктор Берман, Тед Берс, Дик ДеБлазио, Энди Дрозд, Марк Эпштейн, Александр Гельман, Джим Хьюз, Ричард Хьюлетт, Янг Кюн Ким, Джозеф Л. Кёпфингер*, Джон Кулик, Дэвид Дж. Лоу, Тед Олсен, Гленн Парсонс, Рон Петерсен, Нараянан Рамачандран, Джон Уолтер Росдаль, Сэм Шиакка, Ховард Вольфман

(*Почетный член)

Также включены следующие представители Совета по стандартам IEEE-SA без права голоса:

* Сатиш К. Аггарвал, представитель NRC
* Майкл Янезич, представитель NIST
* Мишель Д. Тернер
* Менеджер программы стандартов IEEE, разработка документов
* Майкл Д. Кипнесс
* Менеджер программы стандартов IEEE, разработка технической программы

# Рекомендуемая практика IEEE для Информационные технологии — Телекоммуникации и обмен информацией между системами — Локальные и городские сети — Особые требования. Часть 15.5: Возможность топологии сетки в Беспроводных персональных сетях (WPAN)

**ВАЖНОЕ УВЕДОМЛЕНИЕ**: Этот стандарт не предназначен для обеспечения безопасности, защиты, здоровья или защиты окружающей среды при любых обстоятельствах. Разработчики стандарта несут ответственность за определение соответствующих правил безопасности, защиты, охраны окружающей среды и здоровья или нормативных требований.

Этот документ IEEE предоставляется для использования с учетом важных уведомлений и юридических отказов от ответственности. Эти уведомления и отказы от ответственности появляются во всех публикациях, содержащих этот документ, и могут быть найдены под заголовком «Важное уведомление» или «Важные уведомления и отказы от ответственности относительно документов IEEE». Их также можно получить по запросу в IEEE или просмотреть на сайте <http://standards.ieee.org/IPR/disclaimers.html>

## Обзор

Сетка беспроводной персональной сети (WPAN) — это сеть WPAN с топологией сетки. Этот документ определяет рекомендуемую практику для сеток WPAN.

## Область применения

Область применения настоящего стандарта заключается в предоставлении рекомендуемой практики для предоставления архитектурной структуры, позволяющей устройствам WPAN продвигать совместимые, стабильные и масштабируемые беспроводные сетчатые топологии и, при необходимости, предоставлять текст поправок к текущим стандартам WPAN, которые требуются для внедрения этой рекомендуемой практики.

## Цель

Целью этого проекта является содействие беспроводным топологиям ячеистой сети, оптимизированным для сетей WPAN IEEE 802.15.

Топология ячеистой сети предоставляет следующие возможности для сетей WPAN:

* Расширение покрытия сети без увеличения мощности передачи или чувствительности приемника
* Повышение надежности за счет избыточности маршрутов
* Более простая настройка сети
* Лучший срок службы батареи устройства

## Нормативные ссылки

Следующие ссылочные документы являются обязательными для применения этого документа (т. е. они должны быть поняты и использованы, поэтому каждый ссылочный документ цитируется в тексте, и его связь с этим документом объясняется). Для датированных ссылок применяется только указанное издание. Для недатированных ссылок применяется последнее издание ссылочного документа (включая любые поправки или исправления).

IEEE Std 802.15.3™-2003, Стандарт IEEE для информационных технологий — Телекоммуникации и обмен информацией между системами — Локальные и городские сети — Специальные требования Часть 15.3: Характеристики управления доступом к беспроводной среде (MAC) и физического уровня (PHY) для высокоскоростных беспроводных персональных сетей (WPAN).

IEEE Std 802.15.3b™-2005, Стандарт IEEE для информационных технологий — Телекоммуникации и обмен информацией между системами — Локальные и городские сети — Специальные требования Часть 15.3: Характеристики управления доступом к беспроводной среде (MAC) и физического уровня (PHY) для высокоскоростных беспроводных персональных сетей (WPAN) Поправка 1: Подуровень MAC.

IEEE Std 802.15.4™-2006, Стандарт IEEE для информационных технологий — Телекоммуникации и обмен информацией между системами — Локальные и городские сети — Специальные требования Часть 15.4: Характеристики управления доступом к беспроводной среде (MAC) и физического уровня (PHY) для низкоскоростных беспроводных персональных сетей (WPAN).

## Определения

Для целей настоящего проекта рекомендуемой практики применяются следующие термины и определения. Авторитетный словарь терминов стандартов IEEE следует использовать для терминов, не определенных в этом пункте.

* active duration: A time period defined in both synchronous and asynchronous energy saving modes in the mesh sublayer during which a mesh device accesses the common channel using carrier sense multiple access with collision avoidance mechanism.
* предок: Устройство, которое находится ближе к корню логического дерева, чем это устройство по дереву.
* дочернее устройство: Устройство, которое ассоциируется с устройством. Уровень дерева дочернего устройства на единицу больше, чем у устройства. Если уровень дерева устройства равен i, то все его дочерние устройства (дети) будут иметь уровень дерева, равный i+1.
* потомок: Устройство, которое находится дальше от корня логического дерева, чем устройство.
* конечное устройство: Устройство, которое не способно ретранслировать кадры данных для других устройств.
* затопление: Метод широковещательной рассылки, при котором каждое устройство, кроме исходного отправителя, получает и ретранслирует те же широковещательные кадры данных ровно один раз.
* координатор группы: Контроллер определенной многоадресной группы.
* член группы: Устройство участвует в многоадресной связи.
* неактивная продолжительность: период времени, определенный как в синхронном, так и в асинхронном режиме энергосбережения в подуровне сетки, в течение которого устройство сетки может отключить свою схему приемника для экономии энергии. Неактивная продолжительность следует за активной продолжительностью по времени.
* расширенный сосед: устройство, меньшее или равное meshExtendedNeighborHopDistance-прыжков от устройства, где meshExtendedNeighborHopDistance является атрибутом Mesh Information Base (MeshIB). Соседи, находящиеся на расстоянии более одного прыжка, не могут напрямую общаться друг с другом.
* адрес сетки: логический адрес, назначенный устройству сетки в подуровне сетки. Каждый адрес сетки уникален в сети сетки, поэтому устройство сетки может быть уникально идентифицировано.
* координатор сетки: сущность, которая управляет сетью сетки. Он относится к корню логического дерева сети сетки, уровень дерева которой равен нулю.
* сетчатое устройство: Устройство, способное передавать кадры данных для других устройств.
* таблица обнаружения сетки: Временная таблица, в которой регистрируется информация обо всех соседних устройствах, обнаруженных в процессе обнаружения сетки.
* таймер подслоя сетки: Таймер для дополнительного режима энергосбережения для подслоя сетки.
* мобильность: Функция, позволяющая перемещать устройство из одного места в другое в пределах покрытия сети, сохраняя сеанс связи во время перемещения.
* многоадресный маршрутизатор: Устройство, которое не является членом многоадресной группы, но ретранслирует многоадресные кадры данных для
одной или нескольких многоадресных групп.
* многоадресный агент: Устройство, по крайней мере одно из конечных устройств которого является членом многоадресной группы.
* сосед: Устройство, которое находится в зоне связи текущего устройства.
* соседний MPNC: MPNC, которые находятся на расстоянии одного перехода от MPNC с прямой связью.
* оптимальный маршрут: маршрут с минимальной стоимостью, предоставляемый топологическим сервером.
* переносимость: функция, позволяющая перемещать устройство из одного места в другое в пределах покрытия сети и возобновлять работу в новом месте. В отличие от мобильности, сеанс связи не поддерживается во время перемещения.
* синхронизатор региона: сетчатое устройство, которое отвечает за отправку кадров запроса синхронизации своим дочерним устройствам.
* остаточное время CTA: время назначения времени канала, доступное в MPNC.
* маршрутизация сервера: метод маршрутизации, который выполняется топологическими серверами, распределенными по сетчатой сети.
* устройство-брат: сосед устройства с одним переходом, который не является ни его родителем, ни его потомками.
* длительность синхронизации: длительность процедуры синхронизации в необязательном
синхронном режиме энергосбережения.
* интервал синхронизации: время между двумя последовательными процессами синхронизации.
* область синхронизации: расстояние перехода, которое должно быть синхронизировано координатором сетки или синхронизатором региона в необязательном синхронном режиме энергосбережения.
* sync-child: логическое дочернее устройство, которое отвечает за поддержание синхронизации со своим синхронным устройством-родителем.
* sync-parent: Логическое родительское устройство, которое отвечает за поддержание синхронизации со своими syncchild-устройствами.
* уровень дерева: Расстояние в количестве переходов между устройством и корнем вдоль логического дерева. Корень дерева всегда имеет нулевой уровень дерева.
* интервал пробуждения: Период времени, определенный для необязательного режима энергосбережения для сетчатого подслоя. Он состоит из активной продолжительности и неактивной продолжительности.

## Сокращения

* ABAT - адаптивная таблица адресации блоков
* AD - активная продолжительность
* ASES - асинхронное энергосбережение
* AO - активный порядок
* APDU - блок данных протокола приложения
* BAT - таблица адресации блоков
* BcstID - идентификатор вещания
* BSID - идентификатор источника маяка
* CTA - распределение времени канала
* DestID - идентификатор назначения
* DA - адрес назначения
* DEV - устройство
* DEVID - идентификатор устройства
* Dly_ACK - отложенное подтверждение
* DME - объект управления устройством
* DO - активный заказ назначения
* EDEV - конечное устройство
* ARC - асинхронный счетчик повторных попыток энергосбережения
* EREP - ответ на расширение
* EREQ - запрос на расширение
* FC - управление кадрами
* FCSL - подуровень конвергенции кадров
* GC - координатор группы
* G-JREQ - запрос на присоединение к группе
* G-JREP - ответ на присоединение к группе
* GM - член группы
* HDTV - телевидение высокой четкости
* IE - информационный элемент
* IMM_ACK - немедленное подтверждение
* LLC - управление логическим каналом
* LST - таблица состояний канала
* LQI - индикация качества канала
* MAC - управление доступом к среде
* MC - координатор сетки
* MDEV - устройство с поддержкой сетки
* MeshID - идентификатор сети сетки
* MHME - объект управления подуровнем сетки
* MHPDU - блок данных протокола сетки
* MHSDU - блок данных сервиса сетки
* MeshIB — база данных сеток
* MPNC — координатор пикосети с поддержкой сеток
* MPNCID — идентификатор координатора пикосети с поддержкой сеток
* MSC — диаграмма последовательности сообщений
* MTR — запись многоадресной транзакции
* MTT — таблица многоадресной транзакции
* MDT — таблица обнаружения сеток
* OUI — организационно уникальный идентификатор
* PDU — блок данных протокола
* PHY — физический уровень
* PIB PAN — база данных
* PLME PHY — сущность управления уровнем
* PN — пикосеть
* PNC — координатор пикосети
* PNCID — идентификатор координатора пикосети
* PNID — идентификатор пикосети
* RT — маршрутизатор
* SA — адрес источника
* SAP — точка доступа к сервису
* SES — синхронное энергосбережение
* TREEID — идентификатор сети дерева
* TTL — время жизни
* WI — интервал пробуждения
* WN — уведомление о пробуждении
* WO — порядок пробуждения
* WPAN — беспроводная персональная сеть

## Низкоскоростная WPAN-сетка

### Общее описание

Этот пункт рекомендуемой практики предоставляет архитектурную структуру, которая позволяет маломощным, низкоскоростным устройствам WPAN продвигать совместимые, стабильные и масштабируемые беспроводные топологии ячеистой сети. Топологии ячеистой сети, как показано на рисунке 1, позволяют устройствам с совместимым MAC/PHY IEEE Std 802.15.4-20063 расширять покрытие сети без увеличения мощности передачи или чувствительности приемника. Другим ключевым преимуществом ячеистой сети является повышенная надежность за счет избыточности маршрутов. Топология ячеистой сети является одной из двух топологий, для поддержки которых был разработан стандарт IEEE Std. 802.15.4-2006, как описано в 5.3 стандарта IEEE Std 802.15.4-2006. Однако задачи определения и реализации функций ячеистой сети выходят за рамки стандарта IEEE Std 802.15.4-2006. Эта рекомендуемая практика обеспечивает стандартный способ создания ячеистой сети по стандарту IEEE 802.15.4-2006 в рамках стандарта IEEE.

Поддерживаемые функции для LR-WPAN включают следующее:

* одноадресная, многоадресная и надежная широковещательная пересылка данных ячеистой сети
* синхронное и асинхронное энергосбережение для ячеистых устройств
* функция трассировки маршрута
* переносимость конечных устройств

Сквозная надежность и безопасность не обеспечиваются на подуровне ячеистой сети в этой версии рекомендуемой практики.

![Рисунок 1 — Иллюстрация топологии ячеистой сети](/images/Figure%201%20—An%20illustration%20of%20mesh%20network%20topology.png)

Применения низкоскоростных сетей WPAN Mesh многочисленны; включая, помимо прочего, домашнюю и промышленную автоматизацию и управление, безопасность и мониторинг окружающей среды, ситуационную осведомленность и отслеживание активов, автоматическое считывание показаний счетчиков, мониторинг личного здоровья и т. д. Примеры вариантов использования могут быть следующими:

* Радиочастотный пульт дистанционного управления, который может управлять всеми AV-устройствами во всех комнатах жилого дома без необходимости прямой видимости
* Беспроводные выключатели света в коммерческом здании, например, универмаге, управляют освещением всего этажа, с возможностью группировки освещения различными способами динамическим образом и включения/выключения их одним нажатием кнопки
* Интеллектуальные счетчики коммунальных услуг образуют ячеистую сеть, собирают данные показаний счетчиков и отправляют данные в коммунальные компании через шлюзы

В пункте 5 настоящего документа термины ячеистая сеть и PAN используются попеременно для обозначения ячеистой сети, поскольку все устройства в ячеистой сети имеют один и тот же идентификатор PAN. Другими словами, меж-PAN-связь не поддерживается в текущей версии стандарта.

Эталонная модель низкоскоростной WPAN-сети показана на рисунке 2.

В плоскости данных подуровень сетки WPAN находится между подуровнем конвергенции служб (SSCS) стандарта IEEE Std 802.2-1998 Logical Link Control (LLC) и подуровнем управления доступом к среде (MAC) стандарта IEEE Std 802.15.4-2006. Подуровень сетки предоставляет услуги следующему более высокому уровню через точку доступа к службе Mesh (Mesh SAP). Для разработчиков, желающих добавить функцию сетки к существующим низкоскоростным приложениям WPAN с минимальными усилиями, Mesh SAP сделан практически идентичным MCPS SAP.

В плоскости управления объект управления подуровнем сетки (MHME) находится между объектом управления приложениями (AME) и объектом управления уровнем MAC (MLME). MHME также взаимодействует с подуровнем сетки на том же уровне. В качестве справки на рисунке также показан объект управления устройством (DME), который имеет доступ и управление всеми уровнями. Однако спецификации как AME, так и DME выходят за рамки данного документа.

![Рисунок 2 — Эталонная модель для низкоскоростной WPAN-сети](/images/Figure%202%20—The%20reference%20model%20for%20low-rate%20WPAN%20mesh%20.png)

### Описание службы сетки

Подуровень сетки предоставляет два типа служб, службу данных сетки и службу управления сеткой, на следующий более высокий уровень через две соответствующие точки доступа к службам, SAP сетки и SAP MHME. Также существует внутренний интерфейс между подуровнем сетки и MHME, позволяющий MHME использовать службу данных подуровня сетки. С другой стороны, подуровню сетки также может потребоваться получить информацию от MHME через этот внутренний интерфейс для составления кадров данных подуровня сетки

#### Служба данных сетки

Функция службы данных подуровня сетки заключается в поддержке транспортировки единиц данных протокола приложения (APDU) между одноранговыми сущностями приложений, находящимися на разных устройствах, которые могут находиться на расстоянии нескольких переходов друг от друга. Как описано в 5.1, примитивы службы данных сетки очень похожи на примитивы MCPS SAP. Разработчики должны обратить особое внимание на различия между ними. В таблице 1 перечислены примитивы, поддерживаемые SAP сетки.

**Таблица 1 — Примитивы сетки SAP**

| MESH SAP примитивы | Запрос  | Подтверждать | Индикация |
| ------------------ | ------- | ------------ | --------- |
| MESH-DATA          | 5.2.1.1 | 5.2.1.2      | 5.2.1.3   |
| MESH-PURGE         | 5.2.1.4 | 5.2.1.5      |           |

##### MESH-DATA.request

Примитив MESH-DATA.request запрашивает передачу SPDU (единицы данных протокола SSCS) от локального объекта SSCS к одному или нескольким одноранговым объектам SSCS. Он очень похож на примитив MCPS-DATA.request на уровне MAC.

Семантика примитива MESH-DATA.request следующая:

```bash
MESH-DATA.request (
                    SrcAddrMode,
                    DstAddrMode,
                    DstAddr,
                    mhsduLength,
                    mhsdu,
                    mhsduHandle,
                    AckTransmission,
                    McstTransmission,
                    BcstTransimission,
                    ReliableBcst
                    ) 
```

В таблице 2 указаны параметры примитива MESH-DATA.request.

**Таблица 2 — Параметры MESH-DATA.request**

| Имя               | Тип              | Допустимый диапазон                                   | Описание                                                                                                                                                                                                                                                                 |
| ----------------- | ---------------- | ----------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| SrcAddrMode       | Целое число      | 0x00–0x03                                             | Режим адресации для этого примитива и последующего MHPDU. Это значение может принимать одно из следующих значений: 0x00 = нет адреса (поля адресации пропущены). (0x01 = зарезервировано. 0x02 = 16-битный короткий адрес. 0x03 = 64-битный расширенный адрес)           |
| DstAddrMode       | Целое число      | 0x00–0x03                                             | Режим адресации назначения для этого примитива и последующего MHPDU. Это значение может принимать одно из следующих значений: 0x00 = нет адреса (поля адресации опущены). (0x01 = зарезервировано. 0x02 = 16-битный короткий адрес. 0x03 = 64-битный расширенный адрес.) |
| DstAddr           | Адрес устройства | Как указано в параметре DstAddrMode                   | Адрес устройства объекта или объектов в случае многоадресной и широковещательной передачи, которым передается MHSDU.                                                                                                                                                     |
| mhsduLength       | Целое число      | ≤ (aMaxMACSafePayloadSize - meshcMaxMeshHeaderLength) | Количество октетов, содержащихся в MHSDU, которые должны быть переданы сущностью подуровня сетки.                                                                                                                                                                        |
| mhsdu             | Набор октетов    | -                                                     | Набор октетов, формирующих MHSDU, который должен быть передан сущностью подуровня сетки.                                                                                                                                                                                 |
| mhsduHandle       | Целое число      | 0x00–0xff                                             | Дескриптор, связанный с MHSDU, который должен быть передан сущностью подслоя сетки.                                                                                                                                                                                      |
| AckTransmission   | Boolean          | TRUE, FALSE                                           | Это поле устанавливается в значение TRUE, если от получателя требуется подтверждение; в противном случае оно устанавливается в значение FALSE.                                                                                                                           |
| McstTransmission  | Boolean          | TRUE, FALSE                                           | Это поле устанавливается в значение TRUE, если данные должны быть многоадресными; в противном случае оно устанавливается в значение FALSE                                                                                                                                |
| BcstTransimission | Boolean          | TRUE, FALSE                                           | Это поле устанавливается в значение TRUE, если данные должны быть переданы; в противном случае оно устанавливается в значение FALSE                                                                                                                                      |
| ReliableBcst      | Boolean          | TRUE, FALSE                                           | Это поле устанавливается в TRUE, если требуется надежная трансляция; в противном случае оно устанавливается в FALSE. Оно имеет смысл только, когда BcstTransmission установлено в TRUE.                                                                                  |

Примитив MESH-DATA.request генерируется локальным объектом SSCS, когда SPDU должен быть передан одноранговому объекту SSCS.

После получения примитива MESH-DATA.request подуровень сетки устройства сначала смотрит на значение поля DstAddrMode. Если значение указывает на то, что используется 64-битный расширенный адрес (0x03), данные могут быть отправлены только его соседям с одним переходом. Поэтому подуровень сетки должен составить MCPS-DATA.request и отправить его на уровень MAC. В этом случае подуровень сетки просто передает запрос с более высокого уровня, не вызывая функции подуровня сетки. b0 поля TxOptions примитива MCPS-DATA.request должен отражать значение AckTransmission; он устанавливается в единицу, когда поле AckTransmission установлено в TRUE, и устанавливается в ноль, когда поле AckTransmission установлено в FALSE. Поля b1 и b2 TxOptions примитива MCPS-DATA.request всегда должны быть установлены в ноль. Остальные поля опций передачи, McstTransmission, BcstTransmission и ReliableBcst, созданы для указания подслою сетки режима передачи данных. Поэтому они имеют значение только для подслоя сетки и не должны отражаться в примитиве MCPS-DATA.request.

Если значение поля DstAddrMode указывает на то, что используется 16-битный короткий адрес (0x02), пунктом назначения может быть либо сосед с одним переходом, либо устройство, находящееся на расстоянии нескольких переходов. Поэтому устройство должно сначала определить, является ли пункт назначения одним из его соседей с одним переходом, просмотрев DstAddr и выполнив поиск адреса назначения в списке соседей, как показано в Таблице 46. Если это так, подуровень сетки должен составить запрос MCPS-DATA.request и отправить его на уровень MAC, как описано выше.

Если пункт назначения не является соседом с одним переходом, подуровень сетки должен определить следующий переход в сети сетки, чтобы направить сообщение данных к конечному пункту назначения. Подуровень сетки должен сначала составить MHPDU для передачи SPDU, полученного от SSCS, как описано в 5.3.2.1. Затем подуровень сетки должен найти следующий переход к месту назначения, используя метод, описанный в 5.5.5, и составить MCPSDATA.request с адресом назначения уровня MAC, установленным на адрес следующего перехода. Затем примитив MCPSDATA.request отправляется на уровень MAC.

Поскольку MHSDU теперь обернут заголовком сетки, полезная нагрузка, отправляемая на уровень MAC, будет MHPDU. MhsduLength должен быть равен или меньше (aMaxMACFrameSize – meshcMaxMeshHeaderLength), где meshcMaxMeshHeaderLength — константа сетки в Таблице 41. Значения в полях, отличных от тех, которые обсуждались выше, должны оставаться неизменными и передаваться на уровень MAC.

Если пункт назначения не является соседом с одним переходом, значения всех четырех полей параметров передачи должны быть записаны в соответствующие биты поля режима передачи поля управления кадром в составленном кадре данных подуровня сетки, как показано на рисунке 5, и переданы на следующие переходы, чтобы информация о режиме передачи могла передаваться во время распространения данных. Обратите внимание, что значения полей параметров передачи имеют только локальные значения. Например, когда AckTransmission установлен в TRUE для указания подтвержденной передачи, это означает только, что уровень MAC этого устройства должен передать кадр данных с использованием подтвержденной передачи и не означает, что поддерживается сквозное подтверждение.

Если MHPDU был успешно передан и подтверждение, если оно было запрошено, было получено, подуровень сетки выдаст примитив MESH-DATA.confirm со статусом SUCCESS.

Если какой-либо параметр в примитиве MESH-DATA.request не поддерживается или находится вне диапазона, подуровень сетки выдаст примитив MESH-DATA.confirm со статусом INVALID_PARAMETER.

##### MESH-DATA.confirm

Примитив MESH-DATA.confirm сообщает о результатах запроса на передачу данных SPDU (MHSDU) из локального объекта SSCS в один или несколько одноранговых объектов SSCS.

Семантика примитива MESH-DATA.confirm следующая:

```bash
MESH-DATA.confirm (
                    mhsduHandle,
                    Status
                    )
```

Table 3 specifies the parameters for the MESH-DATA.confirm primitive.

**Таблица 3 — Параметры MESH-DATA.confirm**

| Имя         | Тип         | Допустимый диапазон                                                                                                                    | Описание                                         |
| ----------- | ----------- | -------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------ |
| mhsduHandle | Целое число | 0x00–0xff                                                                                                                              | Подтверждается идентификатор, связанный с MHSDU. |
| Status      | Enumeration | SUCCESS, TRANSACTION_OVERFLOW, TRANSACTION_EXPIRED, CHANNEL_ACCESS_FAILURE, NO_ACK, UNAVAILABLE_KEY, FRAME_TOO_LONG, INVALID_PARAMETER | Статус последней передачи MHSDU.                 |

Примитив MESH-DATA.confirm генерируется подуровнем сетки в ответ на примитив MESHDATA.request. Примитив MESH-DATA.confirm возвращает либо статус SUCCESS, указывающий на то, что запрос на передачу был успешным, либо код ошибки TRANSACTION_OVERFLOW, TRANSACTION_EXPIRED, CHANNEL_ACCESS_FAILURE, UNAVAILABLE_KEY, NO_ACK, FRAME_TOO_LONG или INVALID_PARAMETER. Причины этих значений статуса полностью описано в 7.1.1.1.3 стандарта IEEE 802.15.4-2006.

После получения примитива MESH-DATA.confirm SSCS инициирующего устройства уведомляется о результате его запроса на передачу. Если попытка передачи была успешной, параметр статуса будет установлен на SUCCESS. В противном случае параметр статуса укажет на ошибку.

##### MESH-DATA.indication

Примитив MESH-DATA.indication указывает на передачу SPDU данных (т. е. MHSDU) из подслоя сетки в локальную сущность SSCS.

Семантика примитива MESH-DATA.indication следующая:

```bash
MESH-DATA.indication (
                        SrcAddrMode,
                        SrcPANId,
                        SrcAddr,
                        mhsduLength,
                        mhsdu
                        )
```

В таблице 4 указаны параметры примитива MESH-DATA.indication.

**Таблица 4 — Параметры индикации MESH-DATA**

| Имя         | Тип              | Допустимый диапазон                 | Описание                                                                                                                                                                                                                                                                              |
| ----------- | ---------------- | ----------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| SrcAddrMode | Целое число      | 0x00–0x03                           | Режим адресации источника для этого примитива, соответствующий полученному MHPDU. Это значение может принимать одно из следующих значений: 0x00 = нет адреса (поля адресации пропущены). 0x01 = зарезервировано. 0x02 = 16-битный короткий адрес. 0x03 = 64-битный расширенный адрес. |
| SrcPANId    | Целое число      | 0x0000–0xffff                       | 16-битный идентификатор PAN объекта, от которого был получен MHSDU.                                                                                                                                                                                                                   |
| SrcAddr     | Адрес устройства | Как указано в параметре SrcAddrMode | Индивидуальный адрес устройства субъекта, от которого был получен MHSDU.                                                                                                                                                                                                              |
| mhsduLength | Целое число      | ≤ aMaxMACFrameSize                  | Количество октетов, содержащихся в MHSDU, указанное сущностью подуровня MESH.                                                                                                                                                                                                         |
| mhsdu       | Набор октетов    | -                                   | Набор октетов, образующих MHSDU, указывается сущностью подуровня MESH.                                                                                                                                                                                                                |

Примитив MESH-DATA.indication генерируется подуровнем сетки и выдается в SSCS при получении соответствующего MCPS-DATA.indication от уровня MAC, который проходит соответствующие операции фильтрации сообщений.

После получения примитива MESH-DATA.indication SSCS уведомляется о прибытии данных на устройство.

##### MESH-PURGE.request

Примитив MESH-PURGE.request позволяет следующему более высокому уровню очистить MHSDU из очереди транзакций.

Семантика примитива MESH-PURGE.request следующая:

```bash
MESH-PURGE.request (
                    mhsduHandle
                    ) 
```

В таблице 5 указаны параметры примитива MESH-PURGE.request.

**Table 5 —MESH-PURGE.request parameters**

| Имя         | Тип         | Допустимый диапазон | Описание                                                            |
| ----------- | ----------- | ------------------- | ------------------------------------------------------------------- |
| mhsduHandle | Целое число | 0x00–0xff           | Дескриптор MHSDU, который необходимо удалить из очереди транзакций. |

Примитив MESH-PURGE.request генерируется следующим более высоким уровнем всякий раз, когда MHSDU должен быть очищен из очереди транзакций.

После получения примитива MESH-PURGE.request подуровень сетки пытается найти в своей очереди транзакций MHSDU, указанный параметром mhsduHandle. Если MHSDU, соответствующий заданному дескриптору, найден, MHSDU отбрасывается из очереди транзакций, и подуровень сетки выдает примитив MESHPURGE.confirm со статусом SUCCESS. Если MHSDU, соответствующий заданному дескриптору, не найден, подуровень сетки выдает примитив MESH-PURGE.confirm со статусом INVALID_HANDLE.

##### MESH-PURGE.confirm

Примитив MESH-PURGE.confirm позволяет сетевому подслою уведомить следующий более высокий уровень об успешности его запроса на очистку MHSDU из очереди транзакций.

Семантика примитива MESH-PURGE.confirm следующая:

```bash
MESH-PURGE.confirm (
                    mhsduHandle,
                    Status
                    ) 
```

В таблице 6 указаны параметры примитива MESH-PURGE.confirm.

**Таблица 6 — Параметры MESH-PURGE.confirm**

| Имя         | Тип         | Допустимый диапазон       | Описание                                                         |
| ----------- | ----------- | ------------------------- | ---------------------------------------------------------------- |
| mhsduHandle | Целое число | 0x00–0xff                 | Дескриптор MHSDU, запрошенный для очистки из очереди транзакций. |
| Status      | Enumeration | SUCCESS or INVALID_HANDLE | Статус запроса на очистку MHSDU из очереди транзакций.           |

Примитив MESH-PURGE.confirm генерируется подуровнем сетки в ответ на примитив MESHPURGE.request. Примитив MESH-PURGE.confirm возвращает статус SUCCESS, что указывает на успешность запроса на очистку, или INVALID_HANDLE, что указывает на ошибку. Причины этих значений статуса полностью описаны в 7.1.1.4.3 стандарта IEEE Std 802.15.4-2006.

При получении примитива MESH-PURGE.confirm следующий более высокий уровень уведомляется о результате своего запроса на очистку MHSDU из очереди транзакций. Если запрос на очистку был успешным, параметр статуса будет установлен на SUCCESS. В противном случае параметр статуса укажет на ошибку.

##### Диаграмма последовательности сообщений службы данных

На рисунке 3 показана последовательность сообщений, необходимая для успешной передачи данных между двумя устройствами.

![Рисунок 3 — Диаграмма последовательности сообщений, описывающая службу данных сетки](/images/Figure%203%20—Message%20sequence%20chart%20describing%20the%20mesh%20data%20service.png)

#### Служба управления сеткой

MHME-SAP позволяет передавать команды управления между SSCS и MHME. Таблица 7 суммирует примитивы, поддерживаемые MHME через интерфейс MHME-SAP. Примитивы обсуждаются в подпунктах, на которые есть ссылки в таблице.

**Таблица 7 — Сводка примитивов, доступных через MHME-SAP**

| Название             | Запрос   | Индикация | Ответ | Подтверждение | Обязательно/Опционально |
| -------------------- | -------- | --------- | ----- | ------------- | ----------------------- |
| MHME-DISCOVER        | 5.2.2.1  |           |       | 5.2.2.2       | Обязательно             |
| MHME-START-NETWORK   | 5.2.2.3  |           |       | 5.2.2.4       | Обязательно             |
| MHME-START-DEVICE    | 5.2.2.5  |           |       | 5.2.2.6       | Обязательно             |
| MHME-JOIN            | 5.2.2.7  | 5.2.2.8   |       | 5.2.2.9       | Обязательно             |
| MHME-LEAVE           | 5.2.2.10 | 5.2.2.11  |       | 5.2.2.12      | Обязательно             |
| MHME-RESET           | 5.2.2.13 |           |       | 5.2.2.14      | Обязательно             |
| MHME-GET             | 5.2.2.15 |           |       | 5.2.2.16      | Обязательно             |
| MHME-SET             | 5.2.2.17 |           |       | 5.2.2.18      | Обязательно             |
| MHME-START-SYNC      | 5.2.2.19 |           |       | 5.2.2.20      | Опционально             |
| MHME-TRACE-ROUTE     | 5.2.2.21 | 5.2.2.22  |       | 5.2.2.23      | Опционально             |
| MHME-MULTICAST-JOIN  | 5.2.2.24 |           |       | 5.2.2.25      | Обязательно             |
| MHME-MULTICAST-LEAVE | 5.2.2.26 |           |       | 5.2.2.27      | Обязательно             |

##### MHME-DISCOVER.request

Этот примитив позволяет следующему более высокому слою запрашивать у сетчатого подуровня обнаружение сетчатых сетей, работающих в данный момент в пределах района.

Семантика примитива следующая:

```bash
MHME-DISCOVER.request (
                        ScanChannels,
                        ScanDuration,
                        ChannelPage,
                        ReportCriteria
                        )
```

В таблице 8 указаны параметры примитива MHME-DISCOVER.request.

**Таблица 8 — Параметры MHME-DISCOVER.request**

| Имя            | Тип          | Допустимый диапазон      | Описание                                                                                                                                                                                                                                                                                                                                                                            |
| -------------- | ------------ | ------------------------ | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ScanChannels   | Битовое поле | 27-битовое поле          | 27 бит (b0, b1,... b26) указывают, какие каналы следует сканировать (1 = сканировать, 0 = не сканировать) для каждого из 27 каналов, поддерживаемых параметром ChannelPage, как определено в стандарте IEEE Std 802.15.4-2006.                                                                                                                                                      |
| ScanDuration   | Целое число  | 0–14                     | Значение, используемое для расчета продолжительности сканирования каждого канала: Время, затрачиваемое на сканирование каждого канала, составляет $(aBaseSuperframeDuration * (2^n + 1))$ символов, где n — значение параметра ScanDuration. Для получения дополнительной информации о сканировании подуровня MAC, как определено в IEEE Std 802.15.4-2006.                         |
| ChannelPage    | Целое число  | 0–31                     | Страница канала, на которой следует выполнить сканирование.                                                                                                                                                                                                                                                                                                                         |
| ReportCriteria | Enumeration  | LINK_QUALITY, TREE_LEVEL | Поле указывает, какой критерий используется для выбора лучшего соседа, который будет передан на следующий более высокий уровень. LINK_QUALITY = Сообщается сосед с наивысшим качеством связи. TREE_LEVEL = Сообщается сосед с самым низким уровнем дерева. Сочетание нескольких критериев допускается, несмотря на то, что алгоритм выходит за рамки данной рекомендуемой практики. |

Этот примитив генерируется следующим более высоким уровнем и выдается на сетчатый подуровень для запроса обнаружения сетей, работающих в рабочей области устройства.

После получения этого примитива сетчатый подуровень попытается обнаружить сети, работающие в рабочей области устройства, выполнив активное сканирование по каналам, указанным в аргументе ScanChannels, и страницам каналов, указанным в аргументе ChannelPage, в течение периода, указанного в параметре ScanDuration. Сканирование выполняется с помощью примитива MLME-SCAN.request.

После получения примитива MLME-SCAN.confirm устройство должно сначала записать соседние устройства, от которых оно получило сигналы, в таблицу обнаружения сетей (MDT), если список PANDescriptorList списка MLMESCAN.confirm не пуст. Каждый маяк, найденный во время сканирования, создаст запись PANDescriptor в списке PANDescriptorList на уровне MAC и соответствующую запись MeshDescriptor в таблице MDT на сетчатом подуровне. Элементы MeshDescriptor не совсем такие же, как у PANDescriptor. Элементы MeshDescriptor показаны в Таблице 9. Обратите внимание, что MDT — это временная таблица, и ее содержимое можно очистить после успешного запуска устройства или присоединения к ячеистой сети. Информация о подуровне сетки
в полезной нагрузке маяка определена на Рисунке 37.

**Таблица 9 — Элементы MESHDesriptor**

| Имя               | Тип         | Допустимый диапазон                                                                                                | Описание                                                                                                                                                                                                                                                                                                                                         |
| ----------------- | ----------- | ------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| PANId             | Целое число | 0x0000–0xffff                                                                                                      | 16-битный идентификатор PAN обнаруженной сети.                                                                                                                                                                                                                                                                                                   |
| Address           | Целое число | 0x0000–0xfffd                                                                                                      | 16-битный короткий адрес отправителя маяка.                                                                                                                                                                                                                                                                                                      |
| LogicalChannel    | Целое число | Выбирается из доступных логических каналов, поддерживаемых PHY, как определено в стандарте IEEE Std 802.15.4-2006. | Текущий логический канал, занятый сетью.                                                                                                                                                                                                                                                                                                         |
| ChannelPage       | Целое число | Выбрано из доступных страниц каналов, поддерживаемых PHY.                                                          | Текущая страница канала, занятая сетью.                                                                                                                                                                                                                                                                                                          |
| MeshVersion       | Целое число | 0x00–0x0f                                                                                                          | Версия протокола подуровня сетки, используемая в обнаруженной сети.                                                                                                                                                                                                                                                                              |
| BeaconOrder       | Целое число | 0x0f                                                                                                               | Это определяет, как часто маяк подуровня MAC должен передаваться данным устройством в сети. Для этой версии рекомендуемой практики значение всегда устанавливается на 0x0f, что указывает на отсутствие периодической передачи маяков. Для обсуждения порядка маяков подуровня MAC см. IEEE Std 802.15.4-2006.                                   |
| SuperframeOrder   | Целое число | 0x0f                                                                                                               | Для сетей, ориентированных на маяки, то есть, порядок маяков < 15, это определяет длину активного периода суперкадра. Для этой версии рекомендуемой практики значение всегда устанавливается равным 0x0f, что указывает на отсутствие периодической передачи маяков. Для обсуждения порядка суперкадра подуровня MAC см. IEEE Std 802.15.4-2006. |
| LinkQuality       | Целое число | 0x00–0xff                                                                                                          | Значение LQI, при котором был получен сетевой маяк. Более низкие значения представляют более низкий LQI.                                                                                                                                                                                                                                         |
| TreeLevel         | Целое число | 0x00–0xff                                                                                                          | Уровень дерева отправителя маяка.                                                                                                                                                                                                                                                                                                                |
| AcceptMeshDevice  | Boolean     | TRUE or FALSE                                                                                                      | Это поле указывает, принимает ли ячеистая сеть новые ячеистые устройства. Значение TRUE указывает, что устройство способно принимать запросы на присоединение от других ячеистых устройств; в противном случае значение должно быть установлено на FALSE.                                                                                        |
| AcceptEndDevice   | Boolean     | TRUE or FALSE                                                                                                      | Это поле указывает, принимает ли ячеистая сеть новые конечные устройства. Значение TRUE указывает, что устройство способно принимать запросы на присоединение от конечных устройств; в противном случае значение должно быть установлено на FALSE.                                                                                               |
| SyncEnergySaving  | Boolean     | TRUE or FALSE                                                                                                      | Это поле указывает, поддерживается ли дополнительная функция синхронного энергосбережения. Значение TRUE указывает, что устройство способно поддерживать синхронное энергосбережение; в противном случае значение должно быть установлено на FALSE.                                                                                              |
| AsyncEnergySaving | Boolean     | TRUE or FALSE                                                                                                      | Это поле указывает, поддерживается ли дополнительная функция асинхронного энергосбережения. Значение TRUE указывает, что устройство способно поддерживать асинхронное энергосбережение; в противном случае значение должно быть установлено на FALSE.                                                                                            |

Затем подуровень сетки должен выдать примитив MHME-DISCOVER.confirm, содержащий информацию об обнаруженных сетях со значением параметра Status, равным значению, возвращаемому с помощью MLMESCAN.confirm.

##### MHME-DISCOVER.confirm

Этот примитив передает на следующий, более высокий уровень результат операции обнаружения сети.

Семантика примитива следующая:

```bash
MHME-DISCOVER.confirm (
                        Status,
                        NetworkCount,
                        MeshDescriptorList
                        )
```

В таблице 10 указаны параметры примитива MHME-DISCOVER.confirm.

**Таблица 10 — Параметры MHME-DISCOVER.confirm**

| Имя                | Тип                                | Допустимый диапазон                                                                                                | Описание                                                              |
| ------------------ | ---------------------------------- | ------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------- |
| Status             | Status                             | Любое значение статуса, возвращаемое примитивом MLMESCAN.confirm                                                   | Определено в 7.1.11.2 стандарта IEEE 802.15.4-2006.                   |
| NetworkCount       | Целое число                        | 0x00–0xff                                                                                                          | Указывает количество сетей, обнаруженных в результате поиска.         |
| MeshDescriptorList | Список дескрипторов ячеистых сетей | Выбирается из доступных логических каналов, поддерживаемых PHY, как определено в стандарте IEEE Std 802.15.4-2006. | Список дескрипторов, по одному для каждой обнаруженной ячеистой сети. |

Этот примитив генерируется MHME и выдается на его следующий более высокий уровень после завершения задачи обнаружения, инициированной примитивом MHME-DISCOVERY.request.

Таблица 9 дает подробный отчет о содержимом MeshDescriptor из параметра MeshDescriptorList. Однако не все записи в MDT передаются на следующий более высокий уровень через примитив MHME-DISCOVER.confirm; среди отправителей маяков с одинаковым PANId только лучший в отношении ReportCriteria должен быть передан на следующий более высокий уровень. Определение критериев отчета является проблемой реализации. Этот стандарт предлагает рассмотреть либо LinkQuality, либо TreeLevel, либо комбинацию двух обнаруженных устройств.

Получив этот примитив, следующий вышестоящий уровень уведомляется о результатах сетевого поиска.

##### MHME-START-NETWORK.request

Этот примитив позволяет следующему более высокому уровню запросить, чтобы устройство запустило новую ячеистую сеть с собой в качестве MC.

Семантика примитива следующая:

```bash
MHME-START-NETWORK.request (
                            ScanChannels,
                            ScanDuration,
                            ChannelPage,
                            BeaconOrder,
                            SuperframeOrder
                            ) 
```

В таблице 11 указаны параметры примитива MHME-START-NETWORK.request.

**Таблица 11 — Параметры запроса MHME-START-NETWORK.request**

| Имя             | Тип          | Допустимый диапазон | Описание                                                                                                                                                                                                                                                                                                                                                           |
| --------------- | ------------ | ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| ScanChannels    | Битовое поле | 27-битовое поле     | 27 бит $(b_0, b_1,... b_26)$ указывают, какие каналы следует сканировать (1 = сканировать, 0 = не сканировать) для каждого из 27 каналов, поддерживаемых параметром ChannelPage, как определено в стандарте IEEE Std 802.15.4-2006.                                                                                                                                |
| ScanDuration    | Целое число  | 0–14                | Значение, используемое для расчета продолжительности сканирования каждого канала: Время, затрачиваемое на сканирование каждого канала, составляет $(aBaseSuperframeDuration * (2^n + 1))$ символов, где $n$ — значение параметра ScanDuration. Для получения дополнительной информации о сканировании подуровня MAC см. 7.1.11.1 стандарта IEEE Std 802.15.4-2006. |
| ChannelPage     | Целое число  | 0–31                | Страница канала, на которой следует выполнить сканирование.                                                                                                                                                                                                                                                                                                        |
| BeaconOrder     | Целое число  | 0x0f                | Порядок маяков сети, который верхние слои хотят сформировать. Для этой версии рекомендуемой практики значение всегда устанавливается на 0x0f, что указывает на отсутствие периодических маяков.                                                                                                                                                                    |
| SuperframeOrder | Целое число  | 0x0f                | Порядок суперфрейма сети, который верхние слои хотят сформировать. Для этой версии рекомендуемой практики значение всегда устанавливается на 0x0f, что указывает на отсутствие передачи периодических маяков.                                                                                                                                                      |

Этот примитив генерируется следующим более высоким уровнем устройства, поддерживающего координатор сетки, и выдается его MHME для запроса инициализации себя в качестве координатора новой сети.

После получения этого примитива устройством, которое не может быть координатором сетки (MC) (путем проверки константы подуровня сетки, meshcCoordinatorCapability), MHME выдает примитив MHME-STARTNETWORK.confirm с параметром Status, установленным на INVALID_REQUEST.

Если устройство должно быть инициализировано как MC, MHME запрашивает, чтобы подуровень MAC сначала выполнил сканирование обнаружения энергии, а затем активное сканирование на указанном наборе каналов. Для этого MHME выдает примитив MLME-SCAN.request подуровню MAC с параметром ScanType, установленным для указания сканирования обнаружения энергии для поиска чистого канала, а затем снова выдает примитив с параметром ScanType, установленным для указания активного сканирования. После завершения активного сканирования, получив примитив MLME-SCAN.confirm от подуровня MAC, MHME выбирает подходящий канал. Подуровень сетки выберет идентификатор PAN, который не конфликтует с идентификатором любой сети, работающей на выбранном канале. Как только будут найдены подходящий канал и идентификатор PAN, MHME выберет 0x0000 в качестве 16-битного короткого MAC-адреса и сообщит об этом подуровню MAC. Для этого MHME выдает примитив MLME-SET.request подуровню MAC для установки атрибута MAC PIB macShortAddress. В то же время подуровень сетки также устанавливает свои атрибуты в MeshIB, такие как meshPANId, meshTreeLevel и meshNetworkAddress. Если подходящий канал или идентификатор PAN не найден, MHME выдает примитив MHME-START-NETWORK.confirm с параметром Status, установленным на STARTUP_FAILURE.

Если в запросе более высокого уровня указан только один канал, MHME не нужно запрашивать сканирование энергии перед запуском сети. Активное сканирование все равно выполняется, чтобы убедиться, что выбран идентификатор PAN, который не конфликтует с идентификатором любой сети, о которой известно, что она работает.

Затем MHME выдает примитив MLME-START.request на уровень MAC. Параметр PANCoordinator примитива MLME-START.request устанавливается в значение TRUE. BeaconOrder и SuperframeOrder будут такими же, как и заданные в MHME-START-NETWORK.request. Параметр CoordRealignment в примитиве MLME-START.request устанавливается в значение FALSE, если примитив выдается для запуска нового PAN. Параметр CoordRealignment устанавливается в значение TRUE, если примитив выдается для изменения любого из атрибутов конфигурации PAN в существующем PAN. Получив связанный примитив MLME-START.confirm, MHME передает примитив MHME-START-NETWORK.confirm на следующий более высокий уровень со статусом, возвращенным из примитива MLME-START.confirm.

##### MHME-START-NETWORK.confirm

This primitive reports to the next higher layer the result of the request to initialize a mesh coordinator in a network.

Семантика примитива следующая:

```bash
MHME-START-NETWORK.confirm (
                            Status
                            ) 
```

В таблице 12 указаны параметры примитива MHME-START-NETWORK.confirm.

**Таблица 12 — Параметры MHME-START-NETWORK.confirm**

| Имя    | Тип    | Допустимый диапазон                                                                                    | Описание                                             |
| ------ | ------ | ------------------------------------------------------------------------------------------------------ | ---------------------------------------------------- |
| Status | Status | INVALID_REQUEST, STARTUP_FAILURE или любое значение статуса, возвращаемое примитивом MLMESTART.confirm | Результат попытки инициализировать координатор сетки |

Этот примитив генерируется MHME и выдается на следующий более высокий уровень в ответ на примитив MHMESTART-NETWORK.request. Примитив возвращает значение статуса INVALID_REQUEST, STARTUP_FAILURE или любое значение статуса, возвращаемое примитивом MLME-START.confirm. Условия, при которых эти значения могут быть возвращены, описаны в 5.2.2.3.

После получения этого примитива следующий более высокий уровень уведомляется о результате своего запроса на инициализацию устройства в качестве координатора сетки. Если MHME был успешным, параметр статуса будет установлен на SUCCESS. В противном случае параметр статуса указывает на ошибку.

##### MHME-START-DEVICE.request

Этот примитив позволяет следующему более высокому уровню сетчатого устройства инициировать действия, ожидаемые от сетчатого устройства, включая маршрутизацию кадров данных и прием запросов на присоединение к сети от других устройств.

Семантика примитива следующая:

```bash
MHME-START-DEVICE.request (
                            BeaconOrder,
                            SuperframeOrder
                            ) 
```

Таблица 13 определяет параметры для MHME-START-DEVICE.request

**Таблица 13 — Параметры MHME-START-DEVICE.request**

| Имя             | Тип         | Допустимый диапазон | Описание                                                                                                                                                                                             |
| --------------- | ----------- | ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| BeaconOrder     | Целое число | 0x0f                | Порядок маяков сети, который верхние уровни хотят сформировать. Для этой версии рекомендуемой практики значение всегда устанавливается на 0x0f, что указывает на отсутствие периодических маяков.    |
| SuperframeOrder | Целое число | 0x0f                | Порядок суперкадра сети, который верхние уровни хотят сформировать. Для этой версии рекомендуемой практики значение всегда устанавливается на 0x0f, указывая, что периодические маяки не передаются. |

Этот примитив генерируется следующим более высоким уровнем нового устройства и выдается его MHME для запроса на инициализацию себя как сетчатого устройства.

При получении этого примитива устройством, которое еще не подключено к ячеистой сети в качестве ячеистого устройства, MHME выдает примитив MHME-START-DEVICE.confirm с параметром Status, установленным на INVALID_REQUEST.

При получении этого примитива MHME устройства, подключенного к ячеистой сети как ячеистое устройство, MHME выдает примитив MLME-START.request на подуровень MAC. Параметры BeaconOrder и SuperframeOrder примитива MLME-START.request будут иметь значения, заданные соответствующими параметрами MHME-START-DEVICE.request. Параметр PANCoordinator в примитиве MLME-START.request установлен на FALSE, указывая, что это устройство не является координатором PAN сети. Параметр CoordRealignment в примитиве MLME-START.request установлен на FALSE, если примитив выдается для запуска в качестве ячеистого устройства в первый раз. Параметр CoordRealignment затем устанавливается на TRUE, если примитив выдается для изменения любого из атрибутов конфигурации PAN.

Получив связанный примитив MLME-START.confirm, MHME выдает примитив MHME-STARTDEVICE.confirm на следующий более высокий уровень со статусом, возвращенным из примитива MLMESTART.confirm. Если и только если статус, возвращенный из примитива MLME-START.confirm, равен
SUCCESS, устройство может начать заниматься маршрутизацией кадров данных и приемом запросов
на присоединение к сети от других устройств. В противном случае устройство не будет заниматься этими действиями.

##### MHME-START-DEVICE.confirm

Этот примитив сообщает результаты запроса на инициализацию сетчатого устройства.

Семантика примитива следующая:

```bash
MHME-START-DEVICE.confirm (
                            Status
                            ) 
```

В таблице 14 указаны параметры для MHME-START-DEVICE.confirm.

**Таблица 14 — Параметр MHME-START-DEVICE.confirm**

| Имя    | Тип    | Допустимый диапазон                                                                | Описание                                             |
| ------ | ------ | ---------------------------------------------------------------------------------- | ---------------------------------------------------- |
| Status | Status | INVALID_REQUEST or any status value returned from the MLMESTART.confirm  primitive | Результат попытки инициализации сетчатого устройства |

Этот примитив генерируется MHME и выдается на его следующий более высокий уровень в ответ на примитив MHMESTART-MESH-DEVICE.request. Этот примитив возвращает значение статуса INVALID_REQUEST или любое значение статуса, возвращаемое примитивом MLME-START.confirm. Условия, при которых эти значения могут быть возвращены, описаны в 5.2.2.5.

При получении этого примитива следующий более высокий уровень уведомляется о результатах своего запроса на инициализацию сетчатого устройства. Если MHME был успешным, параметр статуса будет установлен на SUCCESS. В противном случае параметр статуса указывает на ошибку.

##### MHME-JOIN.request

Этот примитив позволяет следующему более высокому уровню устройства запрашивать присоединение или повторное присоединение к сети.

Семантика примитива следующая:

```bash
MHME-JOIN.request (
                    DirectJoin,
                    ParentDevAddr,
                    PANId,
                    RejoinNetwork,
                    JoinAsMeshDevice,
                    ScanChannels,
                    ScanDuration,
                    ChannelPage,
                    CapabilityInformation
                    ) 
```

**Таблица 15—Параметры запроса MHME-JOIN.request**

| Имя                   | Тип            | Допустимый диапазон      | Описание                                                                                                                                                                                                                                                                                                                                                                     |
| --------------------- | -------------- | ------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| DirectJoin            | Boolean        | TRUE or FALSE            | Значение устанавливается равным TRUE, если выбрано прямое соединение; в противном случае его значение равно FALSE.                                                                                                                                                                                                                                                           |
| ParentDevAddr         | Целое число    | 0x0000–0xffff            | 16-битный короткий адрес родительского устройства для присоединения. Это поле будет считываться только тогда, когда параметр DirectJoin имеет значение, равное TRUE.                                                                                                                                                                                                         |
| PANId                 | Целое число    | 0x0000–0xffff            | 16-битный идентификатор PAN сети для присоединения. Это поле будет считываться только в том случае, если параметр DirectJoin имеет значение, равное TRUE.                                                                                                                                                                                                                    |
| RejoinNetwork         | Целое число    | 0x00–0x01                | Этот параметр управляет методом присоединения к сети. Параметр равен 0x00, если устройство запрашивает присоединение к сети через ассоциацию. Параметр равен 0x01, если устройство присоединяется к сети с помощью процедуры повторного присоединения подуровня сетки. Это поле будет считываться только в том случае, если параметр DirectJoin имеет значение, равное TRUE. |
| JoinAsMeshDevice      | Boolean        | TRUE or FALSE            | Параметру присваивается значение TRUE, если устройство будет функционировать как сетевое устройство; параметру присваивается значение FALSE, если устройство будет функционировать как конечное устройство.                                                                                                                                                                  |
| ScanChannels          | Битовое поле   | 27-битовое поле          | 27 бит $(b_0, b_1,... b_26)$ указывают, какие каналы должны быть просканированы (1 = сканировать, 0 = не сканировать) для каждого из 27 каналов, поддерживаемых параметром ChannelPage. Это поле будет считано только в том случае, если параметр DirectJoin имеет значение, равное FALSE.                                                                                   |
| ScanDuration          | Целое число    | 0–14                     |                                                                                                                                                                                                                                                                                                                                                                              |
| ChannelPage           | Целое число    | 0–31                     |                                                                                                                                                                                                                                                                                                                                                                              |
| CapabilityInformation | Boolean fields | Как описано в Таблице 16 | Эксплуатационные возможности устройства, подключаемого напрямую.                                                                                                                                                                                                                                                                                                             |

**Таблица 16 — Битовые поля информации о возможностях**

| Имя                | Тип     | Допустимый диапазон | Описание                                                                                                                                                                          |
| ------------------ | ------- | ------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| DeviceType         | Boolean | TRUE, FALSE         | Это поле имеет значение TRUE, если присоединяющееся устройство является сетчатым устройством. В противном случае оно имеет значение FALSE.                                        |
| PowerSource        | Boolean | TRUE, FALSE         | Это поле имеет значение TRUE, если питание от сети. В противном случае оно имеет значение FALSE.                                                                                  |
| ReceiverOnWhenIdle | Boolean | TRUE, FALSE         | Это поле устанавливается в TRUE, если приемник включен, когда устройство находится в режиме ожидания. В противном случае оно устанавливается в FALSE.                             |
| AllocateAddress    | Boolean | TRUE, FALSE         | В реализациях данной рекомендуемой практики это поле всегда имеет значение TRUE, что указывает на то, что присоединяющемуся устройству должен быть выдан 16-битный сетевой адрес. |

Следующий более высокий уровень устройства генерирует этот примитив для запроса:

* Присоединяйтесь к новой сети
* Найти и повторно подключиться к сети после отключения

При получении этого примитива устройством, которое в данный момент подключено к сети и имеет параметр RejoinNetwork, равный 0x00, MHME выдает примитив MHME-JOIN.confirm с параметром состояния, установленным на INVALID_REQUEST.

При получении этого примитива устройством, которое в данный момент не подключено к сети и имеет параметр RejoinNetwork, равный 0x00, устройство пытается подключиться к сети. Если параметр DirectJoin имеет значение TRUE, устройство пытается подключиться к родительскому устройству, адрес которого указан в поле ParentDevAddr. MHME выдает запрос MLME-SSOCIATE.request с параметром CoordAddress, установленным в ParentDevAddr, если происходит следующее:

* родительское устройство принадлежит сети, идентифицированной PANId, и
* родительское устройство открыто для запросов на присоединение и имеет емкость соответствующего типа устройства.

Если параметр DirectJoin установлен в значение FALSE, устройство пытается подключиться к сети через соседнее устройство, найденное процедурой обнаружения. MHME выдает запрос MLME-ASSOCIATE.request с параметром CoordAddress, установленным на адрес сетчатого устройства, для которого выполняются следующие условия:

* The mesh device belongs to the network identified by the PANId
* Сетевое устройство открыто для запросов на присоединение и имеет рекламную емкость правильного типа устройства.
* Качество связи для кадров, полученных от этого устройства, таково, что создается качество связи не менее 128 (качество связи варьируется от 0, самого низкого, до 255, самого высокого)

Если в таблице обнаружения сеток есть устройство, как показано в Таблице 9, для которого эти условия верны, параметр LogicalChannel примитива MLME-ASSOCIATE.request устанавливается на тот, который найден в MDT, соответствующий адресу координатора потенциального родителя. Поля параметра CapabilityInformation должны иметь значения, показанные в Таблице 16, а информация о возможностях, собранная здесь, должна храниться как значение атрибута MeshIB meshCapabilityInformation. Если этим требованиям удовлетворяет более одного устройства, то присоединяющееся устройство может выбрать родителя с наименьшим уровнем дерева или/и наивысшим качеством связи. Как взвешивать уровень дерева и качество связи, в этом документе не определено. Разработчикам предоставляется гибкость в выборе способа, который наилучшим образом соответствует требованиям их приложения.

Если в таблице обнаружения сетки нет устройства, для которого условия истинны, подслой сетки должен выдать MHME-JOIN.confirm с параметром Status, установленным на NOT_PERMITTED. В противном случае MHME выдает MHME-JOIN.confirm с параметром Status, установленным на значение параметра status, возвращенное из примитива MLME-ASSOCIATE.confirm.

Если параметр RejoinNetwork равен 0x00, а параметр JoinAsMeshDevice установлен в значение TRUE, устройство будет функционировать как сетчатое устройство в сети. Если параметр JoinAsMeshDevice равен FALSE, то оно присоединится как конечное устройство и не будет участвовать в маршрутизации.

Если устройство получает этот примитив и параметр RejoinNetwork равен 0x01, то оно должно присоединиться к сети, используя процесс повторного присоединения к сетевому подуровню, как описано в 5.5.11.2.

##### MHME-JOIN.indication

Этот примитив позволяет следующему более высокому уровню координатора сетки или устройству сетки получать уведомления, когда новое устройство успешно присоединилось к его сети путем ассоциации или повторно присоединилось с использованием процедуры повторного присоединения подуровня сетки.

Семантика примитива следующая:

```bash
MHME-JOIN.indication (
                        NetworkAddress,
                        ExtendedAddress,
                        CapabilityInformation,
                        RejoinNetwork
                        ) 
```

В таблице 17 указаны параметры примитива MHME-JOIN.indication.

**Таблица 17 — Параметры MHME-JOIN.indication**

| Имя                   | Тип                  | Допустимый диапазон                            | Описание                                                                                                                                                                                                                                                                                                     |
| --------------------- | -------------------- | ---------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| NetworkAddress        | Network address      | 0x0001–0xfffd, или 0xfffe                      | Если короткий сетевой адрес сущности был назначен, это будет короткий адрес, который был добавлен в сеть. В противном случае значение этого параметра будет равно 0xfffe, указывая на то, что короткий адрес не был назначен, и устройство может быть доступно только по его 64-битному расширенному адресу. |
| ExtendedAddress       | 64-битный адрес IEEE | Любой 64-битный адрес IEEE                     | 64-битный адрес IEEE объекта, добавленного в сеть.                                                                                                                                                                                                                                                           |
| CapabilityInformation | Битовое поле         | Как определено в стандарте IEEE 802.15.4-2006. | Определяет эксплуатационные возможности присоединяемого устройства.                                                                                                                                                                                                                                          |
| RejoinNetwork         | Целое число          | 0x00–0x02                                      | Параметр RejoinNetwork, указывающий метод, используемый для присоединения к сети. Параметр равен 0x00 для устройства, присоединенного через ассоциацию. Параметр равен 0x01, если устройство присоединено через процедуру повторного присоединения подслоя сетки.                                            |

Этот примитив генерируется MHME координатора сетки или устройства сетки и выдается на его следующий более высокий уровень при успешном добавлении нового устройства в сеть с использованием ассоциации MAC или при разрешении устройству повторно присоединиться к сети с использованием процедуры повторного присоединения. Обратите внимание, что когда параметр NetworkAddress имеет значение, равное 0xfffe, это означает, что сеть находится в состоянии инициализации, а короткий адрес еще не назначен присоединяющемуся устройству. Это устройство должно позже назначить адреса всем своим дочерним устройствам с помощью фрейма команды назначения адреса, как определено на рисунке 11.

Получив этот примитив, следующий более высокий уровень координатора сети или устройства сети уведомляется о том, что к его сети присоединилось новое устройство.

##### MHME-JOIN.confirm

Этот примитив позволяет уведомить следующий более высокий уровень о результате его запроса на присоединение к сети.

Семантика примитива следующая:

```bash
MHME-JOIN.confirm (
                    Status,
                    NetworkAddress,
                    PANId,
                    ChannelPage,
                    ActiveChannel
                    ) 
```

В таблице 18 указаны параметры примитива MHME-JOIN.confirm.

**Таблица 18 — Параметры MHME-JOIN.confirm**

| Имя            | Тип     | Допустимый диапазон                                                                                                                                    | Описание                                                                                                                                |
| -------------- | ------- | ------------------------------------------------------------------------------------------------------------------------------------------------------ | --------------------------------------------------------------------------------------------------------------------------------------- |
| Status         | Status  | INVALID_REQUEST, NOT_PERMITTED, NO_NETWORKS или любое значение статуса, возвращаемое примитивом MLMEASSOCIATE.confirm или примитивом MLMESCAN.confirm. | Статус соответствующего запроса.                                                                                                        |
| NetworkAddress | Integer | 0x0001–0xffff                                                                                                                                          | 16-битный сетевой адрес, который был выделен этому устройству. Этот параметр будет равен 0xffff, если попытка присоединения не удалась. |
| PANId          | Integer | 0x0000–0xfffe                                                                                                                                          | 16-битный идентификатор PAN сети, членом которой теперь является устройство.                                                            |
| ChannelPage    | Integer | 0–31                                                                                                                                                   | Страница канала, на которой был найден ActiveChannel.                                                                                   |
| ActiveChannel  | Integer | Количество каналов, поддерживаемых PHY, как определено в стандарте IEEE 802.15.4-2006.                                                                 | Значение параметра phyCurrentChannel, равное текущему каналу сети, к которой было подключено устройство.                                |

Этот примитив генерируется инициирующим MHME и передается на его следующий более высокий уровень в ответ на примитив MHME-JOIN.request.

Если запрос не был успешным, этот примитив должен быть отправлен на следующий более высокий уровень, как только статус запроса на присоединение станет известен. Параметр статуса должен указывать код ошибки INVALID_REQUEST, NOT_PERMITTED, NO_NETWORKS или любое значение статуса, возвращаемое либо примитивом MLMEASSOCIATE.confirm, либо примитивом MLME-SCAN.confirm. Причины этих значений статуса полностью описаны в 5.2.2.8.

Если запрос был успешным, этот примитив не отправляется на следующий более высокий уровень, пока короткий адрес не будет успешно назначен путем получения кадра команды назначения адреса от родительского устройства. Может ли присоединяющееся устройство получить короткий адрес немедленно с помощью этого запроса на присоединение, зависит от рабочих состояний (инициализация или работа) его родительского устройства. В случае, если его родительское устройство находится в рабочем состоянии, это устройство может немедленно получить короткий адрес от родительского устройства. В противном случае это устройство просто связано с родительским устройством с помощью его 64-битного расширенного адреса. Устройства в этом состоянии должны использовать свои 64-битные расширенные адреса для сообщения своих дочерних номеров родительским устройствам. Короткий адрес будет назначен после того, как родительское устройство получит назначение блока адреса от своего собственного родителя. Поэтому подуровень сетки должен удерживать сообщение подтверждения, пока короткий адрес не будет назначен родительским устройством. Обратите внимание, что следующий более высокий уровень не может передавать какие-либо данные, пока не будет получено сообщение подтверждения.

Получив этот примитив, следующий более высокий уровень инициирующего устройства уведомляется о результате его запроса на присоединение к сети с использованием процедуры ассоциации подуровня MAC или на повторное присоединение к сети после его временного выхода.

##### MHME-LEAVE.request

Этот примитив позволяет следующему более высокому уровню запросить, чтобы он или дочернее устройство покинули сеть.

Семантика примитива следующая:

```bash
MHME-LEAVE.request (
                    DeviceAddress,
                    RemoveSelf,
                    RemoveChildren
                    ) 
```

Таблица 19 определяет параметры примитива MHME-LEAVE.request.

**Таблица 19 — Параметры запроса MHME-LEAVE.request**

| Имя            | Тип              | Допустимый диапазон        | Описание                                                                                                                                                                                                               |
| -------------- | ---------------- | -------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| DeviceAddress  | Адрес устройства | Любой 64-битный адрес IEEE | 64-битный IEEE-адрес дочернего устройства, которое необходимо удалить из сети                                                                                                                                          |
| RemoveSelf     | Boolean          | TRUE, FALSE                | Этот параметр имеет значение TRUE, если устройство попросили удалить себя из сети. В противном случае он имеет значение FALSE.                                                                                         |
| RemoveChildren | Boolean          | TRUE, FALSE                | Этот параметр имеет значение TRUE, если устройство, которому предлагается покинуть сеть, также получает запрос на удаление своих дочерних устройств, если таковые имеются. В противном случае он имеет значение FALSE. |

Следующий более высокий уровень устройства генерирует этот примитив для запроса на выход из сети. Следующий более высокий уровень координатора сети или устройства сети также может генерировать этот примитив для удаления устройства из сети.

При получении этого примитива MHME устройства, которое в данный момент не подключено к сети, MHME выдает примитив MHME-LEAVE.confirm со статусом INVALID_REQUEST. При получении этого примитива MHME устройства, которое в данный момент подключено к сети, с параметром RemoveSelf, установленным на TRUE, и параметром RemoveChildren, установленным на FALSE, MHME удалит себя из сети, как описано в 5.5.7.1. По сути, MHME должен отправить кадр команды hello своим соседям, чтобы указать на свой выход и очистить все свои ссылки на ячеистую сеть. Затем он должен выдать примитив MLME-RESET.request на  MAC-подуровень. Если примитив MHME-LEAVE.request получен с параметром RemoveSelf, установленным на TRUE, и параметром RemoveChildren, равным TRUE, то MHME должен сначала попытаться удалить дочерние элементы устройства, прежде чем удалить себя из сети.

Получив этот примитив координатором сети или устройством сети и при параметре RemoveSelf, установленном в значение FALSE, MHME определяет, является ли указанное устройство дочерним устройством. Если запрошенное устройство не существует, MHME выдает примитив MHME-LEAVE.confirm со статусом UNKNOWN_CHILD_DEVICE. Если запрошенное  устройство существует, MHME попытается удалить его из сети, следуя процедуре, описанной в 5.5.7.2. По сути, MHME должен сначала отправить команду оставить запрошенному устройству, и устройство само удалит себя, следуя процедуре, описанной в 5.5.7.1. Если параметр RemoveChildren равен TRUE, то устройству будет предложено удалить также и его дочерние устройства. Получив подтверждение команды выхода, MHME выдаст примитив MHME-LEAVE.confirm с DeviceAddress, равным 64-битному адресу IEEE удаленного устройства, и параметром Status, равным статусу, предоставленному примитивом MCPS-DATA.confirm.

##### MHME-LEAVE.indication

Этот примитив позволяет уведомить следующий более высокий уровень устройства, если это устройство покинуло сеть или если соседнее устройство покинуло сеть.

Семантика примитива следующая:

```bash
MHME-LEAVE.indication (
                        DeviceAddress
                        ) 
```

В таблице 20 указаны параметры примитива MHME-LEAVE.indication.

**Таблица 20 — Параметры индикации MHME-LEAVE.**

| Имя           | Тип                  | Допустимый диапазон         | Описание                                                   |
| ------------- | -------------------- | --------------------------- | ---------------------------------------------------------- |
| DeviceAddress | 64-битный адрес IEEE | Любой 64-битный, адрес IEEE | 64-битный адрес IEEE объекта, который удалил себя из сети. |

Этот примитив генерируется MHME сетчатого устройства и выдается на его следующий более высокий уровень при получении команды выхода, запрашивающей выход из сети. Он также генерируется MHME сетчатого устройства и выдается на его следующий более высокий уровень, чтобы указать, что сосед покинул сеть при получении командного кадра приветствия с флагом выхода из сети, установленным на единицу.

При получении этого примитива следующий более высокий уровень координатора сетки или устройства сетки уведомляется о том, что устройство, ранее находившееся в сети, покинуло ее. Примитив также может указывать на то, что следующий более высокий уровень устройства сетки или конечного устройства уведомлен о том, что он был удален из сети его связанным с ним устройством сетки или координатором сетки.

##### MHME-LEAVE.confirm

Этот примитив позволяет следующему более высокому уровню получать уведомления о результатах своего запроса на выход из сети для себя или другого устройства.

Семантика примитива следующая:

```bash
MHME-LEAVE.confirm (
                    Status,
                    DeviceAddress
                    ) 
```

В таблице 21 указаны параметры примитива MHME-LEAVE.confirm.

**Таблица 21 — Параметры MHME-LEAVE.confirm**

| Имя           | Тип                  | Допустимый диапазон                                                                                              | Описание                                                                                                               |
| ------------- | -------------------- | ---------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------- |
| Status        | Status               | SUCCESS, INVALID_REQUEST, UNKNOWN_CHILD_DEVICE или любой другой статус, возвращаемый примитивом MCPSDATA.confirm | Статус соответствующего запроса                                                                                        |
| DeviceAddress | 64-битный адрес IEEE | Any 64-bit, IEEE address                                                                                         | 64-битный адрес IEEE в запросе, на который это подтверждение или ноль, если устройство запросило удаление себя из сети |

Этот примитив генерируется инициирующим MHME и выдается его следующему более высокому уровню в ответ на примитив MHME-LEAVE.request. Если запрос был успешным, параметр статуса указывает на успешную попытку выхода. В противном случае параметр статуса указывает на код ошибки INVALID_REQUEST, UNKNOWN_CHILD_DEVICE или статус, выдаваемый примитивом MCPS-DATA.confirm. Причины этих значений статуса полностью описаны в 5.2.2.10.

Получив этот примитив, следующий более высокий уровень инициирующего устройства уведомляется о результатах его запроса на выход из сети для себя или дочернего устройства.

##### MHME-RESET.request

Этот примитив позволяет следующему более высокому слою запросить у сетчатого подслоя выполнение операции сброса.

Семантика примитива следующая:

```bash
MHME-RESET.request (
                    ) 
```

Этот примитив не имеет параметров.

Этот примитив генерируется следующим более высоким уровнем и выдается его MHME для запроса сброса подуровня сетки в его начальное состояние.

После получения этого примитива MHME сначала проверяет, подключен ли он к каким-либо сетям. Если он подключен к сети, MHME должен транслировать кадр команды hello, чтобы указать на то, что он покидает свои соседи до meshTTLOfHello hops. Если он не подключен ни к каким сетям, MHME должен пропустить проверку и перейти непосредственно к выдаче примитива MLME-RESET.request подуровню MAC с параметром SetDefaultPIB, установленным на TRUE. По получении соответствующего примитива MLME-RESET.confirm подуровень сетки сбрасывает его, очищая все внутренние переменные, записи таблицы обнаружения сетки и устанавливая все атрибуты MeshIB на значения по умолчанию. После сброса подуровня сетки MHME выдает MHMERESET.confirm с параметром Status, установленным на SUCCESS, если подуровень MAC был успешно сброшен.

Если этот примитив выдается MHME устройства, которое в данный момент подключено к сети, любые требуемые попытки выхода с использованием примитива MHME-LEAVE.request должны быть приоритетными по усмотрению следующего более высокого уровня.

##### MHME-RESET.confirm

Этот примитив позволяет следующему более высокому слою быть уведомленным о результатах его запроса на сброс подуровня сетки.

Семантика примитива следующая:

```bash
MHME-RESET.confirm (
                    Status
                    )
```

В таблице 22 указаны параметры этого примитива.

**Таблица 22 — Параметр MHME-RESET.confirm**

| Имя    | Тип    | Допустимый диапазон                                                                                                    | Описание                  |
| ------ | ------ | ---------------------------------------------------------------------------------------------------------------------- | ------------------------- |
| Status | Status | Любое значение статуса, возвращаемое примитивом MLME-RESET.confirm, как определено в стандарте IEEE Std 802.15.4-2006. | Результат операции сброса |

Этот примитив генерируется MHME и выдается на его следующий более высокий уровень в ответ на примитив MHMERESET.request. Если запрос был успешным, параметр Status будет иметь значение SUCCESS. В противном случае параметр status будет иметь код ошибки, указывающий причину сбоя. Причины этих значений статуса полностью описаны в 5.2.2.13.

##### MHME-GET.request

Этот примитив позволяет следующему более высокому слою считывать значение атрибута из MeshIB, которое определено в Таблице 42.

Семантика примитива следующая:

```bash
MHME-GET.request (
                 MIBAttribute
                 )
```

В таблице 23 указаны параметры этого примитива.

**Таблица 23 — Параметр MHME-GET.request**

| Имя              | Тип         | Допустимый диапазон       | Описание                                 |
| ---------------- | ----------- | ------------------------- | ---------------------------------------- |
| MeshIB Attribute | Целое число | Как описано в Таблице 42. | Идентификатор атрибута MeshIB для чтения |

Получив примитив MHME-GET.request, MHME проверяет, является ли атрибут MeshIB атрибутом MeshIB или атрибутом MAC/PHY PIB. Если запрошенный атрибут является атрибутом MeshIB, MHME пытается извлечь запрошенный атрибут MeshIB из своей базы данных. Если идентификатор атрибута MeshIB не найден в базе данных, MHME выдаст примитив MHME-GET.confirm со статусом UNSUPPORTED_ATTRIBUTE. Если запрошенный атрибут MeshIB успешно извлечен, MHME выдаст примитив MHME-GET.confirm со статусом SUCCESS.

Если запрошенный атрибут является атрибутом MAC/PHY PIB, запрос передается на MAC путем выдачи примитива MLME-GET.request. MHME выдаст примитив MHME-GET.confirm на следующий более высокий уровень с параметром состояния, полученным в результате перевода, и параметрами MIBAttribute и MIBAttributeValue, равными возвращаемым примитивом MLME.

##### MHME-GET.confirm

Этот примитив сообщает результаты попытки прочитать значение атрибута из MIB.

Семантика примитива следующая:

```bash
MHME-GET.confirm (
                    Status,
                    MIBAttribute,
                    MIBAttributeLength,
                    MIBAttributeValue
                    ) 
```

В таблице 24 указаны параметры этого примитива.

**Таблица 24 — Параметры MHME-GET.confirm**

| Имя                | Тип         | Допустимый диапазон                             | Описание                                               |
| ------------------ | ----------- | ----------------------------------------------- | ------------------------------------------------------ |
| Status             | Enumeration | SUCCESS, UNSUPPORTED_ATTRIBUTE                  | Результаты запроса на чтение значения атрибута MeshIB. |
| MIBAttribute       | Integer     | Как описано в Таблице 42.                       | Идентификатор атрибута MeshIB, который был прочитан.   |
| MIBAttributeLength | Integer     | 0x0000–0xffff                                   | Длина возвращаемого значения атрибута в октетах.       |
| MIBAttributeValue  | Various     | Атрибут специфичен, как определено в Таблице 42 | Значение атрибута MeshIB, которое было считано.        |

Этот примитив генерируется MHME и выдается на его следующий более высокий уровень в ответ на примитив MHMEGET.request. Этот примитив возвращает либо статус SUCCESS, указывающий на то, что запрос на чтение атрибута MeshIB был успешным, либо код ошибки UNSUPPORTED_ATTRIBUTE. Причины этих значений статуса полностью описаны в 5.2.2.15.

Получив этот примитив, следующий более высокий уровень уведомляется о результатах своего запроса на чтение атрибута MeshIB.

##### MHME-SET.request

Этот примитив позволяет следующему более высокому слою записывать значение атрибута в MIB.

Семантика примитива следующая:

```bash
MHME-SET.request (
                    MIBAttribute,
                    MIBAttributeLength,
                    MIBAttributeValue
                    )
```

В таблице 25 указаны параметры этого примитива.

**Таблица 25 — Параметры MHME-SET.request**

| Имя                | Тип     | Допустимый диапазон                                       | Описание                                                    |
| ------------------ | ------- | --------------------------------------------------------- | ----------------------------------------------------------- |
| MIBAttribute       | Integer | As described in Table 42                                  | Идентификатор атрибута MeshIB, который необходимо записать. |
| MIBAttributeLength | Integer | 0x0000―0xffff                                             | Длина устанавливаемого значения атрибута в октетах.         |
| MIBAttributeValue  | Various | The value of the MeshIB attribute that should be written. | Значение атрибута MeshIB, которое следует записать.         |

Этот примитив должен быть сгенерирован следующим более высоким уровнем и передан его MHME для записи значения атрибута в MIB.

Получив примитив MHME-SET.request, MHME проверяет, является ли MIBAttribute атрибутом MeshIB или атрибутом MAC/PHY PIB. Если запрошенный атрибут является атрибутом MeshIB, MHME пытается записать заданное значение в указанный атрибут MeshIB в своей базе данных. Если параметр MIBAttribute указывает атрибут, который является атрибутом только для чтения, MHME выдаст примитив MHME-SET.confirm со статусом READ_ONLY. Если параметр MIBAttribute указывает атрибут, который не найден в базе данных, MHME выдаст примитив MHME-SET.confirm со статусом UNSUPPORTED_ATTRIBUTE. Если параметр MIBAttributeValue указывает значение, которое выходит за пределы допустимого диапазона для заданного атрибута, MHME выдаст примитив MHME-SET.confirm со статусом INVALID_PARAMETER. Если запрошенный атрибут MeshIB успешно записан, MHME выдаст примитив MHME-SET.confirm со статусом SUCCESS.

Если запрошенный атрибут является атрибутом MAC/PHY PIB, запрос передается на MAC путем выдачи примитива MLME-SET.request. MHME выдаст примитив MHME-SET.confirm следующему более высокому уровню с параметром статуса, полученным в результате перевода, и параметром MIBAttribute, равным параметру, возвращаемому примитивом MLME.

##### MHME-SET.confirm

Примитив сообщает результаты попытки записать значение в атрибут MeshIB.

Семантика примитива следующая:

```bash
MHME-SET.confirm (
                    Status,
                    MIBAttribute
                    )
```

**Таблица 26 — Параметры MHME-SET.confirm**

| Имя          | Тип         | Допустимый диапазон                                  | Описание                                            |
| ------------ | ----------- | ---------------------------------------------------- | --------------------------------------------------- |
| Status       | Enumeration | SUCCESS, INVALID_PARAMETER или UNSUPPORTED_ATTRIBUTE | Результаты запроса на запись атрибута MeshIB.       |
| MIBAttribute | Integer     | Как описано в Таблице 42.                            | Идентификатор атрибута MeshIB, который был записан. |

Примитив генерируется MHME и выдается на его следующий более высокий уровень в ответ на примитив MHMESET.request. Этот примитив возвращает либо статус SUCCESS, указывающий, что запрошенное значение было записано в указанный атрибут MeshIB, либо код ошибки INVALID_PARAMETER или UNSUPPORTED_ATTRIBUTE. Причины этих значений статуса полностью описаны в 5.2.2.17.

При получении этого примитива следующий более высокий уровень уведомляется о результатах своего запроса на запись значения атрибута MeshIB. Если запрошенное значение было записано в указанный атрибут MeshIB, параметр статуса будет установлен на SUCCESS. В противном случае параметр статуса указывает на ошибку.

##### MHME-START-SYNC.request

Примитив позволяет следующему более высокому слою координатора сетки запросить у подуровня сетки запуск синхронизации для синхронного энергосбережения (SES).

Семантика примитива следующая:

```bash
MHME-START-SYNC.request (
                            AO,
                            WO,
                            SyncRegion,
                            SyncInterval
                            )
```

В таблице 27 указаны параметры примитива MHME-START-SYNC.request.

**Таблица 27 — Параметры запроса MHME-START-SYNC.request**

| Имя          | Тип     | Допустимый диапазон | Описание                                                                                                                                                                                                                           |
| ------------ | ------- | ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| AO           | Integer | 0–WO or 15          | Длина активной части временной структуры. Если WO имеет значение 15, этот параметр игнорируется. Обратитесь к 5.5.10.2.1 для объяснения взаимосвязи между AO и активной длительностью.                                             |
| WO           | Integer | 0–15                | Интервал времени, в течение которого устройство периодически просыпается в режиме энергосбережения. Значение 15 указывает, что SES не будет использоваться. См. 5.5.10.2.1 для объяснения связи между WO и интервалом пробуждения. |
| SyncRegion   | Integer | 0x00–0xff           | Расстояние прыжка, которое должно быть синхронизировано координатором сети или синхронизатором региона в течение периода синхронизации.                                                                                            |
| SyncInterval | Integer | 0x00–0xff           | Количество интервалов пробуждения для периодической синхронизации.                                                                                                                                                                 |

Этот примитив генерируется следующим более высоким уровнем координатора сетки и выдается его MHME для запроса процедуры синхронизации для SES.

При получении этого примитива устройством, которое не может быть координатором сетки (MC) (путем проверки константы подуровня сетки, meshcCoordinatorCapability), MHME выдает примитив MHME-STARTSYNC.confirm с параметром состояния, установленным на INVALID_REQUEST. В противном случае MHME координатора сетки должен попытаться запустить процедуру синхронизации, отправив фрейм команды запроса синхронизации с параметрами AO, WO, SyncRegion, SyncInterval и временной меткой в ​​фрейме.

Координатор сети должен передать два последовательных кадра команды запроса синхронизации с параметрами временной метки в кадрах.

Если MHME координатора сети получает кадр ответа синхронизации от каждого из своих дочерних устройств, он должен выдать примитив MHME-START-SYNC.confirm на следующий более высокий уровень и начать работать в режиме SES со следующего интервала пробуждения.

##### MHME-START-SYNC.confirm

Этот примитив передает на следующий, более высокий уровень результаты процедуры синхронизации.

Семантика примитива следующая:

```bash
MHME-START-SYNC.confirm (
                        Status
                        )
```

В таблице 28 указаны параметры примитива MHME-START-SYNC.confirm.

Таблица 28 — Параметры MHME-START-SYNC.confirm

| Имя    | Тип         | Допустимый диапазон                         | Описание                                                                                                |
| ------ | ----------- | ------------------------------------------- | ------------------------------------------------------------------------------------------------------- |
| Status | Enumeration | INVALID_REQUEST, SYNC_SUCCESS, SYNC_FAILURE | Результаты попытки запуска процедуры синхронизации с использованием схемы синхронного энергосбережения. |

Этот примитив генерируется MHME и выдается на его следующий более высокий уровень в ответ на примитив MHMESTART-SYNC.request. Он отправляется, когда MHME координатора сетки получает кадр ответа синхронизации от каждого из своих дочерних устройств. Примитив возвращает значение статуса INVALID_REQUEST, SYNC_SUCCESS или SYNC_FAILURE в зависимости от статуса инициализации процедуры синхронизации.

##### MHME-TRACE-ROUTE.request

Этот примитив позволяет следующему более высокому уровню сетчатого устройства запрашивать у сетчатого подуровня трассировку маршрута до определенного пункта назначения.

Семантика примитива следующая:

```bash
MHME-TRACE-ROUTE.request (
                            DestAddr,
                            ResponseTimeout,
                            BatchSize,
                            maxTTL
                            )
```

В таблице 29 указаны параметры примитива MHME-TRACE-ROUTE.request.

**Таблица 29 — Параметры запроса MHME-TRACE-ROUTE.request**

| Имя             | Тип     | Допустимый диапазон | Описание                                                                                           |
| --------------- | ------- | ------------------- | -------------------------------------------------------------------------------------------------- |
| DestAddr        | Integer | 0x0000–0xfffd       | Указывает адрес сетки назначения.                                                                  |
| ResponseTimeout | Integer | 0–16,777,215        | Ограничение времени ожидания для кадров ответа трассировки маршрута в миллисекундах.               |
| BatchSize       | Integer | 0–255               | Количество кадров запроса трассировки маршрута, которые должны быть переданы для каждого перехода. |
| maxTTL          | Integer | 0–255               | Максимальное количество переходов, разрешенных для распространения кадра команды traceroute.       |

Этот примитив генерируется следующим более высоким уровнем устройства и выдается его MHME для отслеживания маршрута к месту назначения, указанному в этом примитиве.

Получив этот примитив, подуровень сетки должен выдать фрейм команды запроса трассировки маршрута в направлении пункта назначения, используя предоставленные параметры.

##### MHME-TRACE-ROUTE.indication

Этот примитив позволяет следующему более высокому слою сетчатого устройства быть уведомленным об успешном получении кадра команды traceroute response. Он возвращает время прохождения сигнала в обоих направлениях между отправителем запроса traceroute и промежуточным сетчатым устройством или устройством назначения.

Семантика примитива следующая:

```bash
MHME-TRACE-ROUTE.indication (
                                Status,
                                SrcAddr,
                                RTTStamp,
                                HopCount
                                )
```

В таблице 30 указаны параметры примитива MHME-TRACE-ROUTE.indication.

**Таблица 30 — Параметры индикации MHME-TRACE-ROUTE.**

| Имя      | Тип     | Допустимый диапазон | Описание                                                                                                      |
| -------- | ------- | ------------------- | ------------------------------------------------------------------------------------------------------------- |
| Status   | Boolean | TRUE, FALSE         | Если TRUE, это указывает на успешный прием кадра ответа traceroute в течение ResponseTimeout.                 |
| SrcAddr  | Integer | 0x0000–0xfff7       | Указывает адрес сетки источника кадра ответа traceroute.                                                      |
| RTTStamp | Integer | 0–65535             | Длительность времени в миллисекундах между отправкой запроса traceroute и получением кадра ответа traceroute. |
| HopCount | Integer | 0x00–0x0f           | Количество переходов между отправителем ответа traceroute и данным устройством.                               |

Этот примитив генерируется сетчатым подслоем устройства и передается на его следующий более высокий уровень.

Получив этот примитив, следующий вышестоящий уровень уведомляется о результате текущего шага маршрута трассировки.

##### MHME-TRACE-ROUTE.confirm

Этот примитив используется для сообщения окончательного результата запроса MHME-TRACE-ROUTE.

Семантика примитива следующая:

```bash
MHME-TRACE-ROUTE.confirm (
                            DestAddr,
                            Status
                            )
```

В таблице 31 указаны параметры примитива MHME-TRACE-ROUTE.confirm.

**Таблица 31 — Параметры MHME-TRACE-ROUTE.confirm**

| Имя      | Тип     | Допустимый диапазон | Описание                                                                                                                                            |
| -------- | ------- | ------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------- |
| DestAddr | Integer | 0x0000–0xfff7       | Указывает адрес сетки назначения кадра команды запроса traceroute.                                                                                  |
| Status   | Boolean | TRUE, FALSE         | Если TRUE, указывает на успешное получение ответа traceroute от пункта назначения в пределах maxTTL, указанного примитивом MHME-TRACEROUTE.request. |

Этот примитив генерируется сетчатым подслоем устройства и передается на его следующий более высокий уровень.

При получении этого примитива следующий более высокий уровень уведомляется об окончательном результате трассировки маршрута. Это также указывает на то, что процесс трассировки маршрута завершен.

##### MHME-MULTICAST-JOIN.request

Этот примитив позволяет следующему более высокому уровню устройства запросить MHME для присоединения к многоадресной группе.

Семантика примитива следующая:

```bash
MHME-MULTICAST-JOIN.request (
                                GroupAddress,
                                GCAddress,
                                JoinAsGC
                                )
```

**Таблица 32 — Параметры запроса MHME-MULTICAST-JOIN.request**

| Имя          | Тип     | Допустимый диапазон | Описание                                                                                                                                             |
| ------------ | ------- | ------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| GroupAddress | Integer | 0x0001–0xfffe       | Указывает адрес группы многоадресной рассылки, к которой устройство намеревается присоединиться.                                                     |
| GCAddress    | Integer | 0x0001–0xffff       | Индивидуальный адрес координатора группы этой многоадресной группы. Значение 0xffff указывает, что индивидуальный адрес GC неизвестен или не указан. |
| JoinAsGC     | Boolean | TRUE, FALSE         | Указывает, присоединяется ли устройство в качестве координатора группы.                                                                              |

Этот примитив генерируется следующим более высоким уровнем устройства и отправляется его MHME для запроса на присоединение к многоадресной группе, указанной параметром GroupAddress.

Получив этот примитив, MHME устройства проверяет, присоединилось ли устройство к группе многоадресной рассылки. Если оно уже является членом группы, MHME выдает примитив MHME-MULTICASTJOIN.confirm со статусом, установленным на INVALID_REQUEST.

Если он еще не является членом группы, он должен проверить, является ли он конечным устройством. Если это конечное устройство, MHME должен выдать команду запроса на присоединение к группе (G-JREQ) своему родительскому устройству с битом конечного устройства поля Join Options, установленным для указания конечного устройства. Затем родительское устройство должно присоединиться к группе многоадресной рассылки от имени своего конечного устройства.

Если он еще не является членом группы и не является конечным устройством, он проверяет, установлен ли параметр JoinAsGC. Если параметр установлен в значение TRUE, MHME должен выдать команду G-JREQ координатору сетки, как описано в 5.5.8.2.1. Если параметр установлен в значение FALSE, MHME должен выдать команду GJREQ, следуя процессу, описанному в 5.5.8.2.1. Параметр GCAddress, если он указан, может использоваться для маршрутизации фрейма команды запроса на присоединение в направлении GC.

##### MHME-MULTICAST-JOIN.confirm

Этот примитив позволяет MHME устройства сообщать о результате присоединения к многоадресной группе.

Семантика примитива следующая:

```bash
MHME-MULTICAST-JOIN.confirm (
                                Status
                                )
```

Этот примитив генерируется MHME и выдается на следующий более высокий уровень устройства в ответ на примитив MHME-MULTICAST-JOIN.request.

Если запрос не был успешным, этот примитив должен быть отправлен на следующий более высокий уровень, как только статус запроса на присоединение станет известен. Параметр статуса должен указывать код ошибки INVALID_REQUEST или GC_NOT_YET_JOINED.

Если в ответ на командный кадр G-JREQ получен командный кадр ответа на присоединение к группе (G-JREP), MHME должен выдать на свой следующий более высокий уровень примитив MHME-MULTICAST-JOIN.confirm со статусом, установленным на SUCCESS.

Получив этот примитив, следующий более высокий уровень инициирующего устройства уведомляется о результатах его запроса на присоединение к многоадресной группе

##### MHME-MULTICAST-LEAVE.request

Этот примитив позволяет следующему более высокому уровню устройства запросить MHME покинуть многоадресную группу.

Семантика примитива следующая:

```bash
MHME-MULTICAST-LEAVE.request (
                                GroupAddress
                                )
```

**Таблица 33 — Параметры запроса MHME-MULTICAST-LEAVE.request**

| Имя          | Тип     | Допустимый диапазон | Описание                                                    |
| ------------ | ------- | ------------------- | ----------------------------------------------------------- |
| GroupAddress | Integer | 0x0001–0xfffe       | Адрес группы многоадресной рассылки, которую нужно покинуть |

Этот примитив генерируется следующим более высоким уровнем устройства и отправляется его MHME для запроса на выход из многоадресной группы, указанной параметром адреса группы.

Получив этот примитив, MHME устройства должен проверить, является ли устройство членом группы multicast. Если оно не является членом группы, MHME выдает примитив MHME-MULTICASTLEAVE.confirm со статусом INVALID_REQUEST.

Если он является членом группы, MHME устройства должен проверить, является ли устройство конечным устройством. Если это конечное устройство, оно должно покинуть группу многоадресной рассылки, отправив командный фрейм запроса на выход из группы (GLREQ) своему родительскому устройству.

Если он не является ни членом группы, ни конечным устройством, он должен попытаться покинуть группу, выдав фрейм команды hello с полями, связанными с multicast, указывающими на выход. Процесс выхода из multicast подробно описан в 5.5.8.2.2.

##### MHME-MULTICAST-LEAVE.confirm

Этот примитив используется для сообщения о результате выхода из многоадресной группы.

Семантика примитива следующая:

```bash
MHME-MULTICAST-LEAVE.confirm (
                                Status
                                )
```

Этот примитив генерируется MHME и передается на следующий более высокий уровень координатора сети или устройства сети в ответ на примитив MHME-MULTICAST-LEAVE.request.

Если запрос не был успешным, этот примитив должен быть отправлен на следующий более высокий уровень, как только статус запроса на присоединение станет известен. Параметр статуса должен указывать код ошибки INVALID_REQUEST или любые допустимые значения статуса.

Если процесс выхода прошел успешно, MHME должен выдать на следующий более высокий уровень примитив MHMEMULTICAST-LEAVE.confirm со статусом SUCCESS.

Получив этот примитив, следующий более высокий уровень инициирующего устройства уведомляется о результатах его запроса на выход из группы многоадресной рассылки.

### Форматы кадров

#### Общий формат кадра службы сетки

Общий кадр службы сетки должен быть отформатирован, как показано на рисунке 4. Некоторые подполя поля могут быть зарезервированы для будущего использования, и они должны быть установлены в ноль для всех реализаций на основе этой версии рекомендуемой практики. Для каждого кадра службы сетки все зарезервированные биты должны быть установлены в ноль при передаче и должны игнорироваться при получении. Кадры службы сетки будут переданы на уровень MAC и должны переноситься в полезной нагрузке кадров данных MAC.

![Рисунок 4 — Общий формат кадра службы сетки](/images/Figure%204%20—%20General%20mesh%20service%20frame%20format%20.png)

##### Поле управления кадром

Поле «Управление кадром» должно быть отформатировано, как показано на рисунке 5.

![Рисунок 5 — Поле управления кадром](/images/Figure%205%20—%20Frame%20Control%20field%20.png)

Подполе «Версия протокола» должно быть установлено на единицу для всех реализаций, основанных на этой версии рекомендуемой практики.

Допустимые значения поля «Тип кадра» приведены в таблице 34.

**Таблица 34 — Допустимые значения подполя «Тип кадра»**

| Значение типа кадра | Название типа рамы |
| ------------------- | ------------------ |
| 0                   | Кадр данных        |
| 1                   | Командный кадр     |

Подполя Destination и Source Address Mode указывают, используются ли в полях Destination и Source Address 64-битные расширенные адреса или 16-битные короткие адреса. Подполя должны быть установлены в ноль, когда используются 64-битные расширенные адреса, и в единицу, когда используются 16-битные короткие адреса.

Подполе Transmission Options указывает способ передачи кадра. Параметры опции передачи AckTransmission, McstTransmission, BcstTransmission и ReliableBcst примитива MESHDATA.request должны использоваться для заполнения этого поля в кадре данных. Эта информация будет передана с полезной нагрузкой данных к месту назначения, чтобы все промежуточные устройства знали, как передавать кадр данных как на подуровне сетки, так и на уровне MAC.

![Рисунок 6 — Допустимые значения подполя «Параметры передачи»](/images/Figure%206%20—%20Valid%20values%20of%20Transmission%20Options%20subfield%20.png)

##### Поле адреса назначения

Адрес назначения — это либо 64-битный расширенный адрес, либо 16-битный короткий адрес, как указано в подполе «Режим адреса назначения» поля «Управление кадром».

##### Поле исходного адреса

Исходный адрес — это либо 64-битный расширенный адрес, либо 16-битный короткий адрес, как указано в подполе «Режим исходного адреса» поля «Управление кадром».

#### Полезная нагрузка сетчатого подслоя

Mesh sublayer payload may contain different subfields and be in various lengths depending on the frame type field defined in Table 34 The details are described in 5.3.2.

#### Формат отдельных типов кадров

##### Кадр данных

Полезная нагрузка подуровня сетки кадра данных должна быть отформатирована, как показано на рисунке 7.

![Рисунок 7 — Формат фрейма данных](/images/Figure%207%20—Format%20of%20the%20data%20frame.png)

Подробная информация о поле «Управление маршрутизацией» показана на рисунке 8.

![Рисунок 8 — Формат поля управления маршрутизацией](/images/Figure%208%20—Format%20of%20the%20Routing%20Control%20field%20.png)

Флаг Up-down используется для обнаружения петель маршрутизации и несоответствий состояния канала, как описано в 5.5.5.1. Расчет его значения проиллюстрирован в 5.5.6.1.

##### Командный кадр

Общий командный фрейм должен быть отформатирован, как показано на рисунке 9.

![Рисунок 9 — Формат командного кадра](/images/Figure%209%20—Format%20of%20the%20command%20frame%20.png)

Для всех командных кадров подполе Protocol Version поля Frame Control должно иметь значение 1. Подполе Frame Type также должно иметь значение 1, что указывает на командный кадр.

Подробная информация о поле идентификатора кадра команды представлена ​​в таблице 35.

**Таблица 35 — Допустимые значения поля идентификаторов кадра команды**

| Команда идентификатор кадра | Имя команды                       | Обязательно/Необязательно | Подпункт   |
| --------------------------- | --------------------------------- | ------------------------- | ---------- |
| 0x01                        | Отчет о количестве детей          | Обязательно               | 5.3.2.2.1  |
| 0x02                        | Назначение адреса                 | Обязательно               | 5.3.2.2.2  |
| 0x03                        | Привет                            | Обязательно               | 5.3.2.2.3  |
| 0x04                        | Запрос информации о соседях       | Обязательно               | 5.3.2.2.4  |
| 0x05                        | Ответ соседа по информации        | Обязательно               | 5.3.2.2.5  |
| 0x06                        | Состояние ссылки                  | Обязательно               | 5.3.2.2.6  |
| 0x07                        | Несоответствие состояния ссылки   | Обязательно               | 5.3.2.2.7  |
| 0x08                        | Зонд                              | Обязательно               | 5.3.2.2.8  |
| 0x09                        | G-JREQ                            | Обязательно               | 5.3.2.2.9  |
| 0x0a                        | G-JREP                            | Обязательно               | 5.3.2.2.10 |
| 0x0b                        | G-LREQ                            | Обязательно               | 5.3.2.2.11 |
| 0x0c                        | Группа оставляет ответ            | Обязательно               | 5.3.2.2.12 |
| 0x0d                        | Уведомление о пробуждении         | Необязательно             | 5.3.2.2.13 |
| 0x0e                        | Запрос на продление               | Необязательно             | Рисунок 24 |
| 0x0f                        | Расширение ответа                 | Необязательно             | 5.3.2.2.15 |
| 0x10                        | Запрос на синхронизацию           | Необязательно             | 5.3.2.2.16 |
| 0x11                        | Синхронизация ответа              | Необязательно             | 5.3.2.2.17 |
| 0x12                        | Запрос на бронирование            | Необязательно             | 5.3.2.2.18 |
| 0x13                        | Ответ на бронирование             | Необязательно             | 5.3.2.2.19 |
| 0x14                        | Повторно присоединиться уведомить | Необязательно             | 5.3.2.2.20 |
| 0x15                        | Запрос трассировки маршрута       | Необязательно             | 5.3.2.2.21 |
| 0x16                        | Ответ трассировки маршрута        | Необязательно             | 5.3.2.2.22 |
| 0x17                        | Оставлять                         | Обязательно               | 5.3.2.2.23 |
| 0x18–0xff                   | Сдержанный                        | -                         | -          |

Команда отчета о количестве детей используется для того, чтобы дочернее устройство сообщало о количестве своих дочерних устройств своему родительскому устройству. Полезная нагрузка командного кадра должна быть отформатирована, как показано на рисунке 10.

![Рисунок 10 — Формат полезной нагрузки фрейма команды отчета о количестве детей](/images/Figure%2010%20—%20Children%20number%20report%20command%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь нулевые значения, указывающие на 64-битные расширенные адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр должен быть одноадресным и запрашивается подтверждение.

Поле Destination Address должно содержать 64-битный расширенный адрес назначения, который должен быть родителем источника. Поле Source Address должно содержать MAC-адрес источника.

Поле «Количество потомков» должно содержать общее количество устройств по ветви дерева, начиная с источника (включая сам источник).

Поле «Количество запрошенных адресов» должно содержать общее количество адресов, запрашиваемых источником. Это значение должно быть равно или больше значения количества потомков.

The address assignment command is used for a parent device to assign an address block to its child devices. The payload of the address assignment frame should be formatted as illustrated in Figure 11.

![Рисунок 11 — Формат полезной нагрузки кадра команды назначения адреса](/images/Figure%2011%20—%20Address%20assignment%20command%20frame%20payload%20format%20.png)

В поле Frame Control подполе Destination Address Mode должно иметь значение ноль, указывающее на 64-битный расширенный адрес, а поле Source Address Mode должно иметь значение единица, указывающее на 16-битный короткий адрес. Подполе Transmission Options должно иметь соответствующие значения, указывающие, что этот кадр должен быть одноадресным, и запрашивается подтверждение.

Поле Destination Address должно содержать 64-битный расширенный адрес назначения, который должен быть дочерним для источника. Поле Source Address должно содержать 16-битный короткий адрес источника.

Поле «Начальный адрес» должно содержать начальный адрес блока адресов, назначенного дочернему элементу.

Поле «Конечный адрес» должно содержать конечный адрес блока адресов, назначенного дочернему элементу. Назначенные адреса также называются короткими адресами или логическими адресами в этой рекомендуемой практике.

Поле Tree Level of Parent Device должно содержать уровень дерева родительского устройства, которое отправляет этот командный кадр. Получатель этого командного кадра может вывести свой собственный уровень дерева (на один уровень больше, чем уровень дерева его родителя) из значения этого поля.

Команда hello используется для обмена информацией о подключении между соседями и для управления сетевым и многоадресным членством в группе. Полезная нагрузка командного кадра должна быть отформатирована, как показано на Рисунок 12.

![Рисунок 12 — Формат полезной нагрузки фрейма команды Hello](/images/Figure%2012%20—Hello%20command%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «один», что указывает на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, что указывает на то, что этот кадр должен быть передан в широковещательном режиме, а подтверждение не запрашивается.

Поле Destination Address должно содержать адрес вещания подслоя сетки. Поле Source Address должно содержать адрес сетки источника.

Поле TTL должно содержать количество переходов, которые разрешено распространять кадру команды hello. Эту информацию можно получить из атрибута meshTTLOfHello MeshIB, как определено в Таблице 42.

Поле «Начальный адрес» должно содержать начальный адрес блока адреса источника.

Поле «Конечный адрес» должно содержать конечный адрес блока адреса источника.

Поле «Уровень дерева» должно содержать уровень дерева, определенный атрибутом meshTreeLevel MeshIB в таблице 42 источника.

Поле Hello Control показано в таблице 36.

**Таблица 36 — Допустимые значения подполя Hello Control**

| Бит       | Контроль                                              | Описание                                                                                                                                                                                                                                            |
| --------- | ----------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| $b_7$     | Выход из сети                                         | Если этот бит установлен в единицу, это означает, что отправитель кадра команды hello покидает сеть.                                                                                                                                                |
| $b_6$     | Адреса групп многоадресной рассылки не указаны        | Если этот бит установлен в единицу, это означает, что поле адресов групп многоадресной рассылки пусто и не требует обработки.                                                                                                                       |
| $b_5$     | Недавно присоединился к группе многоадресной рассылки | Если этот бит установлен в единицу, это означает, что поле адресов групп многоадресной рассылки включает только те группы многоадресной рассылки, членом которых это устройство стало с момента последнего кадра команды приветствия.               |
| $b_4$     | Недавно покинул многоадресную группу                  | Если этот бит установлен в единицу, это указывает на то, что поле адресов групп многоадресной рассылки включает только те группы многоадресной рассылки, из которых это устройство только что вышло с момента последнего кадра команды приветствия. |
| $b_3$     | Полное обновление членства в многоадресной рассылке   | Если этот бит установлен в единицу, это означает, что поле адресов групп многоадресной рассылки содержит полный список групп многоадресной рассылки, членом которых является данное устройство.                                                     |
| $b_{7-0}$ | Сдержанный                                            | -                                                                                                                                                                                                                                                   |

Поле Number of One-hop Neighbors должно содержать количество соседей, которым были назначены логические адреса и которые находятся на расстоянии одного перехода от источника. Эту информацию можно получить из списка соседей, как определено в Таблице 46.

Поле «Количество групп многоадресной рассылки» должно содержать номер адреса группы многоадресной рассылки, который будет включен в поле «Адреса групп многоадресной рассылки».

Поле «Адреса соседей одного перехода» должно содержать короткие адреса всех устройств, которым назначены логические адреса и которые находятся на расстоянии одного перехода от источника.

Поле «Адреса групп многоадресной рассылки» должно содержать адреса групп многоадресной рассылки, к которым это устройство только что присоединилось, покинуло или членом которых является.

Команда запроса информации о соседях используется для сетчатого устройства для запроса информации о соседях от соседей, от которых ожидаемые команды приветствия не получены. Полезная нагрузка кадра запроса информации о соседях должна быть отформатирована, как показано на рисунке 13.

![Рисунок 13 — Формат полезной нагрузки кадра команды запроса информации о соседях](/images/Figure%2013%20—Neighbor%20information%20request%20command%20frame%20payload%20format.png)

В поле Frame Control подполя Destination и Source Address Mode должны иметь значение один, указывающее на 16-битные короткие адреса, а подполе Transmission Options должно иметь соответствующие значения, указывающие на то, что этот кадр должен быть широковещательным, и подтверждение не запрашивается.

Поле Destination Address должно содержать логический широковещательный адрес. Поле Source Address должно содержать логический адрес источника.

Поле TTL всегда должно быть установлено в единицу, чтобы указать, что кадр должен быть широковещательным только соседям с одним переходом.

Поле Number of Extended Neighbors должно содержать количество расширенных соседей, для которых запрашивается информация.

Поле Addresses of Neighbors должно содержать логические адреса всех расширенных соседей, для которых запрашивается информация.

Команда ответа на информацию о соседе отправляется в ответ на полученную команду запроса информации о соседе. Полезная нагрузка командного кадра должна быть отформатирована, как показано на рисунке 14.

![Рисунок 14 — Формат полезной нагрузки кадра команды ответа на информацию о соседе](/images/Figure%2014%20—%20Neighbor%20information%20reply%20command%20frame%20payload%20format.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «единица», указывающие на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр должен быть одноадресным и подтверждение не запрашивается.

Поле Destination Address должно содержать логический адрес назначения. Поле Source Address должно содержать логический адрес источника.

Поле «Количество расширенных соседей» должно содержать количество расширенных соседей, перечисленных в соответствующем кадре запроса информации о соседях, информацию о которых данное устройство может предоставить.

Поле List of Extended Neighbors должно содержать список расширенных соседей, для которых предоставляется информация. Формат каждой записи в поле List of Extended Neighbors должен быть отформатирован, как показано на рисунке 15. Поля Beginning Address, End Address и Tree Level определены в списке соседей, как показано в таблице 46.

![Рисунок 15 — Формат каждой записи в поле «Список расширенных соседей»](/images/Figure%2015%20—%20Format%20of%20each%20entry%20in%20the%20List%20of%20Extended%20Neighbors%20field%20.png)

Команда состояния связи используется для сетчатого устройства, чтобы информировать его соседей о том, что между соседними устройствами может существовать несоответствие состояния связи. Полезная нагрузка командного кадра должна быть отформатирована, как показано на рисунке 16.

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «один», что указывает на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр должен быть одноадресным и запрашивается подтверждение.

Поле Destination Address должно содержать логический адрес назначения. Поле Source Address должно содержать логический адрес источника.

Поле «Количество соседей» должно содержать количество соседей (meshTTLOfHello-1)-хопа.

Поле Neighbor Addresses должно содержать список всех соседей (meshTTLOfHello-1)-hop, о которых сообщает этот кадр. Каждый адрес соседа в списке имеет длину 2 октета. Обратите внимание, что последовательность каждого соседа в списке важна для реконструкции матрицы связности на стороне приемника.

Поле Connectivity Bitmap должно содержать подмножество матрицы связности, как показано в Таблице 47. Это подмножество должно включать матрицу связности $(meshTTLOfHello-1)-hop$ в таблице. В Connectivity Bitmap бит устанавливается в единицу, когда есть соединение, соответствующее двум устройствам в матрице связности (точка пересечения в матрице); в противном случае он устанавливается в ноль. Чтобы сгенерировать Connectivity Bitmap для $n (meshTTLOfHello-1)-hop$ соседей, начиная с $me$ (первая строка, первый столбец) до nbn (первая строка, последний столбец), битовая карта первой строки матрицы связности преобразуется в $CEILING [(n+1)/8]$ октетов (округленных до ближайшего целого числа), где последний октет может быть не полным и должен быть дополнен всеми нулями (дополненные биты в любом случае не будут считаны). Например, когда n равно десяти, первая строка будет сохранена в двух октетах с последними 6 битами последнего октета, равными нулям. Этот процесс продолжается до тех пор, пока все $(n+1)$ строк не будут преобразованы в массив октетов. Общая длина этого массива октетов равна $CEILING [(n+1)/8]×(n+1)$.

Команда несоответствия состояния связи используется для сетчатого устройства, чтобы информировать его соседей о том, что произошло несоответствие состояния связи и его необходимо исправить. Полезная нагрузка командного кадра должна быть отформатирована, как показано на рисунке 17.

![Рисунок 17 — Формат полезной нагрузки командного кадра несоответствия состояния канала](/images/Figure%2017%20—%20Link%20state%20mismatch%20command%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «единица», указывающие на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр должен быть широким и подтверждение не запрашивается.

Поле Destination Address должно содержать логический широковещательный адрес. Поле Source Address должно содержать логический адрес источника.

Поле TTL должно содержать количество переходов, на которое разрешено распространять сообщение о несоответствии состояния канала, которое может достигать $meshExtendedNeighborHopDistance-1$ (из-за соседей, находящихся на расстоянии не более $meshExtendedNeighborHopDistance –1$ переходов).

Поле «Количество соседей» должно содержать количество соседей, имеющих отношение к несоответствию состояния канала.

Поле Addresses of Neighbors должно содержать адреса соседей, которые связаны с несоответствием состояния связи. Соседи, которые вызывают несоответствие состояния связи, могут находиться на расстоянии $meshExtendedNeighborHopDistance –1$ переходов максимум, а значение TTL должно быть равно номеру перехода самого дальнего соседа, который вызывает несоответствие состояния связи.

Команда зондирования используется для сетчатого устройства для проверки соединения с определенным соседом. Полезная нагрузка командного кадра должна быть отформатирована, как показано на рисунке 18.

![Рисунок 18 — Формат полезной нагрузки кадра команды зондирования](/images/Figure%2018%20—%20Probe%20command%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «один», указывающие на короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр должен быть одноадресным и запрашивается подтверждение.

Поле Destination Address должно содержать логический адрес назначения. Поле Source Address должно содержать логический адрес источника.

Командный кадр G-JREQ позволяет устройству присоединиться к определенной многоадресной группе. Полезная нагрузка кадра должна быть отформатирована, как показано на рисунке 19.

![Рисунок 19 — Формат полезной нагрузки командного кадра G-JREQ](/images/Figure%2019%20—%20G-JREQ%20command%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значение «единица», указывающее на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр должен быть одноадресным и запрашивается подтверждение.

Адрес назначения может быть логическим адресом сетчатого устройства, MC или координатора группы (GC). В случае, если адрес назначения является логическим адресом MC (b6 поля опции присоединения установлено на единицу) или GC (b5 поля опции присоединения установлено на единицу), адрес назначения не изменяется до тех пор, пока не будет достигнут MC или GC. В случае, если адрес назначения не является ни MC, ни GC, он будет заменен на промежуточном устройстве адресом следующего перехода, рассчитанным с помощью алгоритма присоединения, описанного в 5.5.8.2.1.

Исходный адрес всегда должен быть установлен на индивидуальный адрес отправителя кадра и оставаться неизменным до тех пор, пока кадр не достигнет устройства, которое может ответить присоединением.

Групповой адрес должен быть установлен на групповой адрес многоадресной рассылки, переданный со следующего более высокого уровня.

Поле «Параметры соединения» описано в таблице 37.

Поле «Счетчик переходов» представляет собой целое число, в котором указывается расстояние перехода, пройденное этой командой G-JREQ.

**Таблица 37 — Поле параметров соединения фрейма G-JREQ**

| Бит       | Параметры                     | Описание                                                                                                                                                                                                                                                            |
| --------- | ----------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| $b_7$     | Присоединяйтесь как GC        | Этот бит устанавливается в единицу, если поле адреса источника в заголовке подуровня сетки содержит логический адрес GC. Он указывает MC, что это устройство будет GC для группы многоадресной рассылки. Во всех остальных случаях этот бит устанавливается в ноль. |
| $B_6$     | MC как пункт назначения       | Этот бит устанавливается в единицу, если поле адреса назначения в заголовке подслоя сетки содержит логический адрес MC. Он указывает, что эта команда G-JREQ отправлена ​​в MC. Он должен быть установлен в ноль, если G-JREQ не отправлен в MC.                    |
| $B_5$     | GC как пункт назначения       | Этот бит устанавливается в единицу, если поле адреса назначения в заголовке подуровня сетки содержит логический адрес GC. Он указывает, что эта команда G-JREQ отправлена ​​GC. Он должен быть установлен в ноль, если G-JREQ не отправлен GC.                      |
| $B_4$     | G-JREP запрошен               | Этот бит устанавливается в единицу, если запрашивается кадр команды G-JREP, когда команда G-JREQ достигает пункта назначения. В противном случае он устанавливается в ноль.                                                                                         |
| $B_3$     | Действовать как маршрутизатор | Если этот бит установлен в единицу, промежуточные устройства, получающие этот G-JREQ, должны изменить свой статус на Router (если они не являются членами группы (GM) или GC), не дожидаясь кадра G-JREP.                                                           |
| $B_2$     | Конечное устройство           | Этот бит устанавливается в единицу, если отправителем этого командного кадра является конечное устройство; в противном случае он устанавливается в ноль.                                                                                                            |
| $b_1-b_0$ | Сдержанный                    | -                                                                                                                                                                                                                                                                   |

Командный кадр G-JREP формируется в ответ на командный кадр G-JREQ и отправляется сетчатым устройством, GC или MC, которые могут подключить запросчика к многоадресной группе. Полезная нагрузка командного кадра должна быть отформатирована, как показано на рисунке 20.

![Рисунок 20 — Формат полезной нагрузки кадра G-JREP](/images/Figure%2020%20—G-JREP%20frame%20payload%20format.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «единица», указывающие на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр должен быть одноадресным и запрашивается подтверждение.

Адрес назначения всегда должен быть установлен на адрес unicast отправителя G-JREQ и не должен изменяться промежуточными устройствами. Адрес источника всегда должен быть установлен на адрес unicast отправителя кадра и оставаться неизменным, пока кадр не достигнет конечного пункта назначения.

Групповой адрес должен быть установлен на групповой адрес многоадресной рассылки, полученный из кадра G-JREQ.

Поле «Параметры соединения» показано в таблице 38.

| Бит       | Параметры   | Описание                                                                                                                                                      |
| --------- | ----------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| $b_7$     | ActAsRouter | Если этот бит установлен в единицу, промежуточные устройства, получающие этот G-JREP, должны изменить свой статус на Router (если они не являются GM или GC). |
| $b_6-b_0$ | Reserved    | -                                                                                                                                                             |

Поле «Статус» отображает статус процесса присоединения к группе, как описано в таблице 39.

| Бит       | Параметры         | Описание                                                                                                                                                                   |
| --------- | ----------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| $b_7$     | SUCCESS           | Этот бит устанавливается в единицу, если присоединяющееся устройство успешно присоединилось к целевому устройству (GM, MC или GC).                                         |
| $b_6$     | FAILURE           | Этот бит устанавливается в единицу, если присоединяющееся устройство не смогло присоединиться к целевому устройству. Причина может быть указана другими битами этого поля. |
| $b_5$     | GC_NOT_YET_JOINED | Этот бит устанавливается в единицу, если G-JREQ достиг MC, но GC еще не присоединился.                                                                                     |
| $b_4-b_0$ | Сдержанный        | -                                                                                                                                                                          |
|           |                   |                                                                                                                                                                            |

Командный кадр G-LREQ позволяет конечному устройству покинуть определенную многоадресную группу. Полезная нагрузка кадра должна быть отформатирована, как показано на рисунке 21.

![Рисунок 21 — Формат полезной нагрузки кадра команды G-LREQ](/images/Figure%2021%20—G-LREQ%20command%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значение «единица», указывающее на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр должен быть одноадресным и запрашивается подтверждение.

Адрес назначения может быть установлен на логический адрес родительского устройства.

Исходный адрес всегда должен быть установлен на логический адрес отправителя кадра.

Групповой адрес должен быть установлен на групповой адрес многоадресной рассылки, переданный со следующего более высокого уровня.

Кадр ответа на команду выхода из группы формируется сетчатым устройством, GC или MC и отправляется на одно из его дочерних устройств, которое является конечным устройством. Полезная нагрузка кадра должна быть отформатирована, как показано на рисунке 22.

![Рисунок 22 — Формат полезной нагрузки кадра ответа на групповой выход](/images/Figure%2022%20—Group%20leave%20reply%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «единица», указывающие на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр должен быть одноадресным и запрашивается подтверждение.

Адрес назначения всегда должен быть установлен на логический адрес отправителя G-LREQ. Адрес источника всегда должен быть установлен на логический адрес отправителя кадра.

Групповой адрес должен быть установлен на групповой адрес многоадресной рассылки, полученный из кадра G-LREQ.

Кадр команды уведомления о пробуждении позволяет сетчатому устройству уведомлять соседей о своей собственной информации о расписании в необязательном режиме энергосбережения. Когда meshASESOn установлен в TRUE, он должен передаваться в начале активной продолжительности для каждого интервала пробуждения. Полезная нагрузка кадра должна быть отформатирована, как показано на рисунке 23.

![Рисунок 23 — Формат полезной нагрузки фрейма команды уведомления о пробуждении](/images/Figure%2023%20—Wakeup%20notification%20command%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «единица», указывающие на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр не является надежной широковещательной передачей.

Адрес назначения должен быть установлен на 0xffff. Адрес источника должен быть установлен на адрес сетки исходного устройства.

ASES Time Info должен содержать $meshWakeupOrder$ и $meshActiveOrder$ устройства сетки. Эти переменные должны быть установлены, как показано на рисунке 24.

![Рисунок 24 — Формат поля информации о времени ASES](/images/Figure%2024%20—Format%20of%20ASES%20Time%20Info%20field%20.png)

Команда запроса расширения кадра позволяет сетчатому устройству запрашивать продление активной продолжительности в пункте назначения на продолжительность, указанную в поле времени расширения полезной нагрузки подуровня сетки. Полезная нагрузка кадра должна быть отформатирована, как показано на рисунке 25.

С помощью широковещательной передачи на уровне MAC подуровень сетки обнаруживает активность канала без фильтрации на уровне MAC. Если пункт назначения совпадает (включая адрес широковещательной передачи), принимающее устройство должно продлить активное время на Extension Time в полезной нагрузке. Если адрес назначения не совпадает, устройство должно игнорировать запрос.

![Рисунок 25 — Формат полезной нагрузки фрейма команды запроса расширения](/images/Figure%2025%20—%20Extension%20request%20command%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «один», что указывает на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, что указывает на то, что этот кадр должен быть ненадежной широковещательной передачей.

Адрес назначения должен быть установлен на адрес сетки устройства назначения или 0xffff. Адрес источника всегда должен быть установлен на адрес сетки устройства источника.

Время расширения содержит необходимое количество времени для продления активного времени в единице meshcTimeUnit.

Командный кадр ответа расширения позволяет сетчатому устройству подтвердить, что запрос расширения активной продолжительности принят. Полезная нагрузка кадра должна быть отформатирована, как показано на рисунке 26.

С помощью широковещательной передачи MAC-уровня уровень сетки обнаруживает активность канала без фильтрации на уровне MAC. Если пункт назначения не совпадает, узел должен игнорировать ответ.

![Рисунок 26 — Формат полезной нагрузки фрейма команды ответа расширения](/images/Figure%2026%20—Extension%20reply%20command%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «единица», указывающие на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр не является надежной широковещательной передачей.

Поле Destination Address всегда должно быть установлено на адрес сетки устройства, отправившего EREQ. Поле Source Address всегда должно быть установлено на адрес сетки источника.

Кадр команды запроса синхронизации позволяет сетчатому устройству синхронизироваться со всеми его дочерними устройствами. Полезная нагрузка кадра должна быть отформатирована, как показано на рисунке 27.

![Рисунок 27 — Формат полезной нагрузки фрейма команды запроса синхронизации](/images/Figure%2027%20—Synchronization%20request%20command%20frame%20payload%20format.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «единица», указывающие на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр не является надежной широковещательной передачей.

Поле Destination Address должно быть установлено на 0xffff. Поле Source Address должно быть установлено на адрес сетки исходного устройства.

Поле Timestamp Value должно содержать предыдущее переданное время первого кадра запроса синхронизации. Это значение получается при получении MCPS-DATA.confirm. Поле Synchronization Specification должно быть отформатировано, как показано на рисунке 28.

![Рисунок 28 — Формат поля спецификации синхронизации](/images/Figure%2028%20—Format%20of%20Synchronization%20Specification%20field%20.png)

Подполе Hop Count должно содержать количество переходов и увеличиваться на единицу для каждого кадра запроса. Подполе Synchronization Region должно содержать количество переходов, которые должны быть синхронизированы координатором сетки или синхронизатором региона в течение времени синхронизации. Подполе Synchronization Frame Order должно содержать порядок кадра запроса синхронизации. Если значение Synchronization Frame Order равно нулю, это указывает на первый кадр запроса синхронизации. Если значение Synchronization Frame Order равно единице, это указывает на второй кадр запроса синхронизации. Подполе Synchronization Interval должно содержать количество интервалов пробуждения для периодической синхронизации. Подполе WO должно содержать значение интервала пробуждения. Подполе AO должно содержать продолжительность времени, в течение которого временная структура активна.

Команда ответа синхронизации позволяет ячеистому устройству подтвердить своему родительскому устройству, что фрейм команды запроса синхронизации был получен. Полезная нагрузка фрейма должна быть отформатирована, как показано на рисунке 29.

![Рисунок 29 — Формат полезной нагрузки кадра команды ответа синхронизации](/images/Figure%2029%20—Synchronization%20reply%20command%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «один», что указывает на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр должен быть одноадресным и запрашивается подтверждение.

Поле Destination Address всегда должно быть установлено на адрес сетки устройства, отправившего фрейм команды запроса синхронизации. Поле Source Address должно быть установлено на адрес сетки исходного устройства.

Команда запроса резервирования позволяет сетчатому устройству запрашивать резервирование передачи данных в определенном периоде слота резервирования временной структуры SES. Полезная нагрузка кадра должна быть отформатирована, как показано на рисунке 30.

![Рисунок 30 — Формат полезной нагрузки фрейма команды запроса на резервирование](/images/Figure%2030%20—Reservation%20request%20command%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «один», что указывает на 16-битные короткие адреса, а поле «Параметры передачи» должно иметь соответствующие значения, что указывает на то, что этот кадр должен быть ненадежной широковещательной передачей.

Поле Destination Address должно быть установлено на адрес широковещательной рассылки подуровня сетки. Поле Source Address должно быть установлено на адрес сетки исходного устройства.

В поле «Предыдущий адрес» необходимо указать адрес сети устройства, которое ранее отправляло команду запроса на резервирование.

В поле «Следующий адрес» необходимо указать адрес сети устройства, которое должно получить этот кадр запроса на резервирование.

В поле «Конечный адрес» необходимо указать адрес сетки конечного устройства назначения.

Поле «Номер слота резервирования» должно содержать порядок передачи данных в неактивной длительности временной структуры SES и увеличивается на единицу для каждого кадра запроса.

Команда ответа на резервирование позволяет сетчатому устройству подтвердить своему родительскому устройству, что кадр команды запроса резервирования был получен. Полезная нагрузка кадра должна быть отформатирована, как показано на рисунке 31.

![Рисунок 31 — Формат полезной нагрузки кадра команды ответа на резервирование](/images/Figure%2031%20—%20Reservation%20reply%20command%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «единица», указывающие на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр должен быть одноадресным и запрашивается подтверждение.

Поле Destination Address всегда должно быть установлено на адрес сетки устройства, отправившего фрейм команды запроса резервирования. Поле Source Address должно быть установлено на адрес сетки исходного устройства.

Команда уведомления о повторном присоединении используется для информирования соответствующих устройств о перемещении портативного устройства, как описано в 5.5.11.3. Полезная нагрузка кадра должна быть отформатирована, как показано на рисунке 32.

![Рисунок 32 — Формат полезной нагрузки фрейма команды уведомления о повторном присоединении](/images/Figure%2032%20—%20Rejoin%20notification%20command%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «один», указывающие на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие, должен ли этот кадр быть одноадресным или широковещательным, и запрашивается ли подтверждение.

Если кадр должен быть отправлен старому родителю, поле Destination Address должно быть установлено на адрес старого родителя, поле TTL должно быть установлено на ноль, и используется одноадресная передача; если кадр должен быть отправлен всем соседям, Destination Address должен быть установлен на 0xffff, а TTL установлен на радиус широковещательной рассылки. Поле Source Address должно содержать MAC-адрес источника. Подробности можно найти в 5.5.11.3.

Поле адреса IEEE должно содержать 64-битный расширенный адрес источника.

Поле «Предыдущий короткий адрес» должно содержать короткий адрес, назначенный исходному устройству до перемещения.

Поле «Новый короткий адрес» должно содержать короткий адрес, назначенный исходному устройству новым родительским устройством после перемещения.

Команда запроса traceroute используется для мониторинга пути маршрутизации между источником и устройством назначения. Полезная нагрузка кадра должна быть отформатирована, как показано на рисунке 33.

![Рисунок 33 — Формат полезной нагрузки фрейма команды запроса Traceroute](/images/Figure%2033%20—%20Traceroute%20request%20command%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «один», указывающие на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр должен быть одноадресным и запрашивается подтверждение.

Адрес назначения должен быть установлен на логический адрес назначения. Поле Адрес источника должно содержать логический адрес источника.

Поле TTL должно содержать количество переходов, которые запрос traceroute может распространить. Эта информация берется из примитива MHME-TRACE-ROUTE.request, определенного в 5.2.2.21.

Поле «Порядковый номер» представляет собой целое число, которое генерируется и поддерживается отправителем кадра запроса трассировки маршрута и увеличивается на единицу для каждого кадра запроса.

Команда traceroute reply используется для ответа на команду traceroute request. Полезная нагрузка кадра должна быть отформатирована, как показано на рисунке 34.

![Рисунок 34 — Формат полезной нагрузки кадра команды ответа Traceroute](/images/Figure%2034%20—%20Traceroute%20reply%20command%20frame%20payload%20format%20.png)

В поле «Управление кадром» подполя «Режим адреса назначения» и «Режим адреса источника» должны иметь значения «один», указывающие на 16-битные короткие адреса, а подполе «Параметры передачи» должно иметь соответствующие значения, указывающие на то, что этот кадр должен быть одноадресным и запрашивается подтверждение.

Адрес назначения должен быть установлен на логический адрес источника команды запроса traceroute. Поле адреса источника должно содержать логический адрес назначения команды запроса traceroute.

Значение поля «Порядковый номер» следует брать из того же поля кадра запроса трассировки маршрута.

Команда leave используется родительским устройством для запроса дочернего устройства покинуть ячеистую сеть. Полезная нагрузка кадра должна быть отформатирована, как показано на рисунке 35.

![Рисунок 35 — Формат полезной нагрузки фрейма команды Leave](/images/Figure%2035%20—Leave%20command%20frame%20payload%20format%20.png)

В поле Frame Control подполя Destination и Source Address Mode должны иметь значения one, указывающие на 16-битные короткие адреса, а подполе Transmission Options должно иметь соответствующие значения, указывающие на то, что этот кадр должен быть одноадресным и запрашивается подтверждение.

Destination Address должен быть установлен на логический адрес назначения. Поле Source Address должно содержать логический адрес источника.

Поле Leave Control должно быть отформатировано, как показано в Таблице 36. Получателю команды leave предлагается удалить все свои дочерние устройства, если бит RemoveChildren установлен на единицу.

![Рисунок 36 — Формат поля «Отпуск»](/images/Figure%2036%20—Format%20of%20Leave%20Control%20field%20.png)

##### Информация о подуровне сетки в полезной нагрузке MAC-маяка

В этом подпункте описывается информация о подуровне сетки, переносимая полезной нагрузкой маяка уровня MAC. Информация содержит подробные описания существующих сетей сетки и устройств, которые отправляют маяки. Она помогает новым устройствам обнаруживать существующие сети сетки и выбирать правильное родительское устройство для присоединения, как описано в 5.2.2 и 5.5.2. Она также содержит необходимые параметры для поддержки таких функций, как маршрутизатор с низким энергопотреблением и портативность. Последовательность бит полезной нагрузки маяка должна быть отформатирована, как показано на рисунке 37.

![Рисунок 37 — Формат полезной нагрузки маяка MAC-уровня](/images/Figure%2037%20—Format%20of%20MAC%20Layer%20beacon%20payload%20.png)

Подробная информация о полях информации подуровня сетки, которые необходимо включить в полезную нагрузку маяка MAC, описана в таблице 40.

**Таблица 40 — Поле информации о подуровне сетки в полезной нагрузке маяка**

| Имя               | Допустимый диапазон | Описание                                                                                                                                                                                                                                                                 |
| ----------------- | ------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| MeshVersion       | 0x00–0x0f           | Версия протокола подуровня сетки, используемая в обнаруженной сети.                                                                                                                                                                                                      |
| TreeLevel         | 0x00–0xff           | Уровень дерева отправителя маяка.                                                                                                                                                                                                                                        |
| AcceptMeshDevice  | один или ноль       | Это поле указывает, принимает ли ячеистая сеть новые ячеистые устройства. Значение, равное единице, указывает, что устройство способно принимать запросы на присоединение от других ячеистых устройств; в противном случае значение должно быть установлено равным нулю. |
| AcceptEndDevice   | один или ноль       | Это поле указывает, принимает ли ячеистая сеть новые конечные устройства. Значение, равное единице, указывает, что устройство способно принимать запросы на присоединение от конечных устройств; в противном случае значение должно быть установлено равным нулю.        |
| ReliableBroadcast | один или ноль       | Это поле указывает, поддерживается ли опциональная надежная трансляция. Значение, равное единице, указывает на то, что устройство способно поддерживать надежную трансляцию; в противном случае значение должно быть установлено равным нулю.                            |
| SyncEnergySaving  | один или ноль       | Это поле указывает, поддерживается ли дополнительная функция синхронного энергосбережения. Значение, равное единице, указывает, что устройство способно поддерживать синхронное энергосбережение; в противном случае значение должно быть установлено на ноль.           |
| AsyncEnergySaving | один или ноль       | Это поле указывает, поддерживается ли дополнительная функция асинхронного энергосбережения. Значение, равное единице, указывает, что устройство способно поддерживать асинхронное энергосбережение; в противном случае значение должно быть установлено равным нулю.     |
| ActiveOrder       | 0x00–0x0f           | Это поле определяет длительность активной продолжительности в интервале пробуждения. Оно должно быть прочитано только тогда, когда поле SyncEnergySaving или AsyncEnergySaving имеет значение TRUE.                                                                      |
| WakeupOrder       | 0x00–0x0f           | Это поле определяет интервал периодического пробуждения. Его следует читать только тогда, когда поле SyncEnergySaving или AsyncEnergySaving имеет значение TRUE.                                                                                                         |

Для координатора сетки полезная нагрузка маяка создается сразу после формирования новой сети сетки. Для всех остальных устройств она создается сразу после присоединения устройств к сети или после изменения любых параметров в таблице 40. Сконструированная полезная нагрузка маяка отправляется в PIB уровня MAC с помощью примитива MLME-SET.request. Атрибут PIB уровня MAC для хранения полезной нагрузки маяка — macBeaconPayload. Атрибут MAC PIB macBeaconPayloadLength должен быть установлен на длину атрибута macBeaconPayload.

#### Константы подслоя сетки, информационная база сетки и значения статуй

##### Константы подслоя сетки

Константы подслоя сетки определяют характеристики подслоя сетки. Они представлены в таблице 41.

**Таблица 41 — Константы подслоя сетки**

| Константы                  | Тип     | Значение    | Описание |
| -------------------------- | ------- | ----------- | -------- |
| meshcCoordinatorCapability | Boolean | TRUE, FALSE |          |
|                            |         |             |          |
|                            |         |             |          |
|                            |         |             |          |
|                            |         |             |          |
|                            |         |             |          |
|                            |         |             |          |

##### База данных сетки

База данных сетки содержит переменные, которые можно настроить, чтобы протокол подуровня сетки соответствовал требованиям различных сценариев применения. Переменные можно считывать и записывать со следующего более высокого уровня через службы подуровня сетки, определенные в 5.2. База данных сетки проиллюстрирована в Таблице 42.

**Таблица 42 — База данных сетки**

| Атрибут                         | Идентификатор | Тип              | Диапазон                                | Описание                                                                                                                                                                                                                                              | Значение по умолчанию                                                                                         |
| ------------------------------- | ------------- | ---------------- | --------------------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| meshNbOfChildren                | 0xa1          | Integer          | 0x00–0xff                               | Количество устройств, которые присоединились к этому устройству.                                                                                                                                                                                      | 0x00                                                                                                          |
| meshCapabilityInformation       | 0xa2          | Bit Vector       | Как описано в Таблице 16.               | Это поле указывает возможности устройства.                                                                                                                                                                                                            | 0x00                                                                                                          |
| meshTTLOfHello                  | 0xa3          | Integer          | 0x00–0xff                               | Количество переходов, которые разрешено пройти кадрам команды hello.                                                                                                                                                                                  | 0x01                                                                                                          |
| meshTreeLevel                   | 0xa4          | Integer          | 0x00–0xff                               | Количество переходов этого устройства от координатора Mesh через его родительское устройство.                                                                                                                                                         | 0x00                                                                                                          |
| meshPANId                       | 0xa5          | Integer          | 0x0000–0xffff                           | PAN ID этой ячеистой сети. Он должен иметь то же значение, что и macPANId                                                                                                                                                                             | 0xffff                                                                                                        |
| meshNeighborList                | 0xa6          | Set              | Variable                                | Этот атрибут содержит информацию о соседях устройства, как определено в Таблице 46.                                                                                                                                                                   | Null set                                                                                                      |
| meshDeviceType                  | 0xa7          | Type Enumeration | MESH_DEVICE, END_DEVICE                 | Этот атрибут имеет значение END_DEVICE, если устройство является конечным устройством, и MESH_DEVICE, если устройство является сетчатым устройством.                                                                                                  | END_DEVICE                                                                                                    |
| meshSequenceNumber              | 0xa8          | Integer          | 0x00–0xff                               | Порядковый номер, используемый для идентификации исходящих кадров.                                                                                                                                                                                    | Случайное значение из диапазона                                                                               |
| meshNetworkAddress              | 0xa9          | Integer          | 0x0000–0xfffe                           | Адрес подслоя сетки этого устройства. Этот атрибут отражает значение атрибута MAC PIB macShortAddress, как определено в IEEE Std 802.15.4-2006, и любые изменения, внесенные более высоким уровнем, также будут отражены в значении атрибута MAC PIB. | 0xffff                                                                                                        |
| meshGroupCommTable              | 0xaa          | Set              | См. Таблицу 48.                         | В этой таблице записаны все многоадресные адреса, членом которых является данное устройство, а также его статус в группе.                                                                                                                             | Null Set                                                                                                      |
| meshAddressMapping              | 0xab          | Set              | переменная, как определено в Таблице 43 | Этот атрибут сопоставляет 64-битные адреса IEEE с 16-битными короткими адресами.                                                                                                                                                                      | Null Set                                                                                                      |
| meshAcceptMeshDevice            | 0xac          | Boolean          | TRUE or FALSE                           | Этот атрибут указывает, позволяет ли данное устройство присоединять к себе другие сетевые устройства в качестве дочерних.                                                                                                                             | FALSE                                                                                                         |
| meshAcceptEndDevice             | 0xad          | Boolean          | TRUE or FALSE                           | Этот атрибут указывает, позволяет ли данное устройство присоединяться к другим конечным устройствам в качестве дочерних.                                                                                                                              | FALSE                                                                                                         |
| meshChildNbReportTime           | 0xae          | Integer          | 0x0000–0xffff                           | Этот атрибут указывает время в секундах, через которое начнется отправка отчета о количестве дочерних устройств после успешного подключения данного устройства к сети.                                                                                | Устанавливается во время сборки (значение этого атрибута может сильно различаться для разных приложений)      |
| meshProbeInterval               | 0xaf          | Integer          | 0x0000–0xffff                           | Этот атрибут устанавливает интервал опроса соседа в секундах, если его статус в списке соседей неизвестен.                                                                                                                                            | 0x10                                                                                                          |
| meshMaxProbeNum                 | 0xb0          | Integer          | 0x00–0xff                               | Максимальное количество неизвестных соседей, которые будут проверены.                                                                                                                                                                                 | 0xff                                                                                                          |
| meshMaxProbeInterval            | 0xb1          | Integer          | 0x0000–0xffff                           | Этот атрибут устанавливает максимальный интервал опроса в секундах для соседа, если его статус в списке соседей неизвестен.                                                                                                                           | 0xffff                                                                                                        |
| MaxMulticastJoinAttempts        | 0xb2          | Integer          | 0x00–0xff                               | Максимальное количество попыток, которые устройство должно предпринять для присоединения к многоадресной группе, прежде чем процесс присоединения будет считаться неудачным.                                                                          | 0x07                                                                                                          |
| meshRBCastTXTimer               | 0xb3          | Integer          | 0x0000–0xffff                           | Этот атрибут указывает время в секундах, которое вещательному устройству необходимо подождать перед повторной трансляцией кадра данных.                                                                                                               | Устанавливается во время сборки (значение этого атрибута может сильно различаться для разных приложений)      |
| meshRBCastRXTimer               | 0xb4          | Integer          | 0x0000–0xffff                           | Этот атрибут указывает максимальное время ожидания в секундах, в течение которого принимающее устройство пересылает широковещательный кадр данных.                                                                                                    | Устанавливается во время сборки (значение этого атрибута может сильно различаться для разных приложений)      |
| meshMaxRBCastTrials             | 0xb5          | Integer          | 0x00–0xff                               | Этот атрибут указывает максимальное количество попыток широковещательной передачи перед выдачей примитива MHMELEAVE.indication для предотвращения возможной недоступности одного или нескольких соседних устройств.                                   | Устанавливается во время сборки (значение этого атрибута может значительно различаться для разных приложений) |
| meshASESOn                      | 0xb6          | Boolean          | TRUE or FALSE                           | Этот атрибут указывает, находится ли данное устройство в режиме ASES.                                                                                                                                                                                 | FALSE                                                                                                         |
| meshASESExpected                | 0xb7          | Boolean          | TRUE or FALSE                           | Этот атрибут указывает, поддерживает ли данное устройство ASES.                                                                                                                                                                                       | FALSE                                                                                                         |
| meshWakeupOrder                 | 0xb8          | Integer          | 0–15                                    | Это определяет, как часто устройство передает свое уведомление о пробуждении. Если порядок пробуждения, WO = 15, устройство не будет передавать периодическое уведомление о пробуждении.                                                              | 15                                                                                                            |
| meshActiveOrder                 | 0xb9          | Integer          | 0–15                                    | Длина активной продолжительности в интервале пробуждения, включая уведомление о пробуждении. Если WO = 15, это значение игнорируется.                                                                                                                 | 15                                                                                                            |
| meshDestActiveOrder             | 0xba          | Integer          | 0–15                                    | Длина активной продолжительности целевого устройства. Если meshASESOn имеет значение FALSE, это значение игнорируется.                                                                                                                                | 0                                                                                                             |
| meshEREQTime                    | 0xbb          | Integer          | 0–255                                   | Максимальное количество meshcTimeUnits для ожидания следующего EREQ или кадра данных, следующего за EREQ.                                                                                                                                             | 30                                                                                                            |
| meshEREPTime                    | 0xbc          | Integer          | 0–255                                   | Максимальное количество meshcTimeUnits для ожидания EREP после передачи EREQ.                                                                                                                                                                         | 15                                                                                                            |
| meshDataTime                    | 0xbd          | Integer          | 0–255                                   | Максимальное количество meshcTimeUnits для ожидания EREQ или кадра данных, следующего за кадром данных.                                                                                                                                               | 15                                                                                                            |
| meshMaxNumASESRetries           | 0xbe          | Integer          | 0–15                                    | Максимальное количество повторных передач в ASES.                                                                                                                                                                                                     | 2                                                                                                             |
| meshSESOn                       | 0xbf          | Boolean          | TRUE or FALSE                           | Этот атрибут указывает, находится ли данный узел в режиме SES.                                                                                                                                                                                        | FALSE                                                                                                         |
| meshSESExpected                 | 0xc0          | Boolean          | TRUE or FALSE                           | Этот атрибут указывает, поддерживает ли данный узел SES.                                                                                                                                                                                              | FALSE                                                                                                         |
| meshSyncInterval                | 0xc1          | Integer          | 0x00–0xff                               | Количество интервалов пробуждения для периодической синхронизации.                                                                                                                                                                                    | 0x0a                                                                                                          |
| meshMaxSyncRequestAttempts      | 0xc2          | Integer          | 0x00–0xff                               | Максимальное количество попыток, которое узел должен предпринять для передачи кадра запроса синхронизации, прежде чем будет считаться, что процедура синхронизации завершилась неудачно.                                                              | 0x03                                                                                                          |
| meshSyncReplyWaitTime           | 0xc3          | Integer          | 0–255                                   | Максимальное количество meshTimeUnits для ожидания кадра ответа синхронизации после передачи кадра запроса синхронизации.                                                                                                                             | 50                                                                                                            |
| meshFirstTxSyncTime             | 0xc4          | Integer          | 0x00000000–0xffffffff                   | Время, когда устройство передало свой первый кадр запроса синхронизации, в периодах символа MAC.                                                                                                                                                      | 0x00000000                                                                                                    |
| meshFirstRxSyncTime             | 0xc5          | Integer          | 0x00000000–0xffffffff                   | Время, когда устройство получило первый кадр запроса синхронизации, в периодах символа MAC.                                                                                                                                                           | 0x00000000                                                                                                    |
| meshSecondRxSyncTime            | 0xc6          | Integer          | 0x00000000–0xffffffff                   | Время, когда устройство получило второй кадр запроса синхронизации, в периодах символа MAC.                                                                                                                                                           | 0x00000000                                                                                                    |
| meshRegionSynchronizaerOn       |               | Boolean          | TRUE or FALSE                           | Этот атрибут указывает, является ли данный узел синхронизатором региона.                                                                                                                                                                              | FALSE                                                                                                         |
| meshExtendedNeighborHopDistance | 0xc7          | Integer          | 0x00–0xff                               | Заранее определенное расстояние между устройством и его расширенными соседями.                                                                                                                                                                        | 0x03                                                                                                          |
| meshRejoinTimer                 | 0xc8          | Integer          | 0x0000–0xffff                           | Время между тем, как дочернее устройство покидает сеть, и удалением дочернего устройства из списка соседей.                                                                                                                                           | 0xffff                                                                                                        |

**Таблица 43 — Сопоставление адресов сетки**

| 64-битный адрес IEEE        | 16-битный короткий адрес                            |
| --------------------------- | --------------------------------------------------- |
| A valid 64-bit IEEE Address | Допустимый 16-битный короткий адрес (0x0000–0xfffe) |

##### Значения состояния сетки

Этот подпункт определяет значения статуса, используемые примитивами подтверждения, которые сообщают о статусе соответствующих примитивов запроса. Значения для параметров статуса подслоя сетки приведены в Таблице 44.

**Таблица 44 — Значения состояния сетки**

| Имя                    | Значение  | Описание                                                                                                       |
| ---------------------- | --------- | -------------------------------------------------------------------------------------------------------------- |
| -                      | 0x01–0xb0 | Сдержанный                                                                                                     |
| INVALID_REQUEST        | 0xb1      | Запрошенная услуга оказалась недействительной.                                                                 |
| NOT_PERMITTED          | 0xb2      | Присоединиться не удалось, так как это не разрешено                                                            |
| NO_NETWORKS            | 0xb3      | Сеть не найдена.                                                                                               |
| READ_ONLY              | 0xb4      | Устанавливаемый атрибут доступен только для чтения.                                                            |
| RECEIVE_SYNC_LOSS      | 0xb5      | Получен кадр уведомления о потере синхронизации.                                                               |
| RECEIVE_SYNC_RESPONSE  | 0xb6      | Получен кадр ответа синхронизации.                                                                             |
| STARTUP_FAILURE        | 0xb7      | Не удалось запустить сеть из-за отсутствия подходящего канала или идентификатора PAN.                          |
| SYNC_FAILURE           | 0xb8      | Запрос синхронизации не был выполнен, поскольку не был получен по крайней мере один кадр ответа синхронизации. |
| SYNC_LOSS              | 0xb9      | Кадр запроса синхронизации не был получен в запланированное время.                                             |
| SYNC_SUCCESS           | 0xba      | Запрос SYNC выполнен успешно.                                                                                  |
| TRACEROUTE_TIMEOUT     | 0xbb      | Кадр команды ответа Traceroute не был получен в течение запрошенного времени ответа.                           |
| TRACEROUTE_UNREACHABLE | 0xbc      | Трассировка маршрута не удалась, так как целевое устройство недоступно.                                        |
| UNKNOWN_CHILD_DEVICE   | 0xbd      | Устройство, для которого был запрошен выход, не является дочерним устройством.                                 |

#### Описание функции сетки

В этом пункте описывается функция, которую подуровень сетки предоставляет следующему более высокому уровню. Эти функции включают одноадресную и многоадресную адресацию, алгоритм одноадресной маршрутизации и алгоритм многоадресной маршрутизации.

##### Запуск ячеистой сети

Обычно ячеистая сеть запускается первым, когда координатор ячеистой сети включает питание. Следующий более высокий уровень MC, который готов запустить свою собственную ячеистую сеть, должен выдать MHME-START-NETWORK.request, как определено в 5.2.2.3, на подуровень ячеистой сети. Затем подуровень ячеистой сети выполнит два сканирования уровня MAC, сначала сканирование обнаружения энергии, а затем активное сканирование. Это выполняется путем выдачи примитива MLME-SCAN.request на подуровень MAC.

Когда примитив MLME-SCAN.confirm возвращается с подуровня MAC, подуровень сетки MC соберет список сетей, работающих в его районе. Если список не пуст, MC должен записать соседние устройства, от которых он получил сигналы, в таблицу обнаружения сетки, как определено в 5.2.2.1. Полезная информация включает в себя идентификатор PAN, режим адреса и адрес каждого устройства (возможны как 16-битные, так и 64-битные адреса), канал, на котором в данный момент работает каждый сосед, информацию, связанную с суперкадром, качество связи от каждого соседа и любую другую информацию, которую разработчики посчитают необходимой для сохранения для будущего использования.

После сбора информации из существующих сетей подуровень сетки MC определит канал и идентификатор PAN, которые он хочет использовать для своей сети. Теперь MC может запустить сеть, выдав примитив MLME-START.request с параметром PANCoordinator, установленным на TRUE, на подуровень MAC. BeaconOrder, SuperframeOrder и другие параметры примитива MLME-START.request будут такими же, как и заданные для MHME-START-NETWORK.request.

Получив примитив MLME-START.request, подуровень MAC переходит в рабочий режим и готов передавать свои маяки по запросу, чтобы разрешить новым устройствам присоединиться к ячеистой сети.

Подробная информация о запуске новой ячеистой сети описана в разделе 5.2.2.3.

##### Присоединение к ячеистой сети

Присоединение к ячеистой сети обычно включает следующие этапы:

* Обнаружение существующих каналов/сетей;
* Выбор канала/сети и родительского устройства для присоединения;

Первое, что должно сделать не-MC устройство, это обнаружить, есть ли работающие сети WPAN поблизости. Следующий более высокий уровень устройства выдаст запрос MHME-DISCOVER.request, как определено в 5.2.2.1, на свой сетчатый подуровень. Сетевой подуровень попытается обнаружить сети, работающие в рабочей зоне устройства, выполнив активное сканирование по каналам, указанным в примитиве MHME-DISCOVER.request. Это сканирование выполняется путем выдачи примитива MLME-SCAN.request на MAC-уровень устройства.

Когда примитив MLME-SCAN.confirm возвращается с уровня MAC, подуровень сетки устройства соберет список сетей, работающих в его районе. Если список не пуст, MC должен записать соседние устройства, от которых он получил сигналы, в таблицу обнаружения сетки, как описано в 5.2.2.1. Полезная информация, которая должна быть записана, включает в себя идентификатор PAN, режим адреса и адрес каждого устройства (возможны как 16-битные, так и 64-битные адреса), канал, на котором в данный момент работает каждый сосед, информацию, связанную с суперкадром, качество связи от каждого соседа и т. д., как определено в IEEE Std 802.15.4-2006. Затем подуровень сетки выдаст примитив MHME-DISCOVER.confirm, содержащий информацию об обнаруженных сетях со значением параметра Status, равным значению, возвращенному с MLME-SCAN.confirm, на следующий более высокий уровень.

Получив примитив MHME-DISCOVER.confirm, следующий более высокий уровень может начать процесс присоединения. Это делается AME, отправляющим запрос MHME-JOIN.request в MHME. AME должен указать в примитиве такие параметры, как идентификатор PAN для присоединения, процесс, который должен использоваться для присоединения на уровне MAC, тип устройства, в качестве которого оно будет работать (сетевое устройство или конечное устройство) и т. д. Обратите внимание, что параметры, связанные с каналом, применяются только в случае, когда устройство пытается повторно присоединиться к сети. На основе информации, указанной в запросе MHME-JOIN.request, сетчатый подуровень попытается найти лучшее соседнее устройство для присоединения, если доступно несколько кандидатов. Критерии, которые необходимо учитывать, включают уровень дерева и качество соединения. Разработчики могут учитывать другие факторы, если их приложение предъявляет особые требования.

После определения соседнего устройства для присоединения устройство отправляет примитив MLME-ASSOCIATE.request на свой уровень MAC с правильно установленными параметрами, как описано в 5.2.2.7. Успешно или нет, подуровень сетки получит MLME-ASSOCIATE.confirm от уровня MAC, указывающий статус процесса ассоциации. Если устройство успешно присоединилось к выбранному им родителю, оно должно обновить свои записи в базе данных, связанные с этим родителем, например, записать своего родителя в свой список соседей и указать связь как «родитель». Подуровень сетки также должен отправить MHME-JOIN.confirm с правильно установленным параметром Status на свой следующий более высокий уровень.

Если устройство присоединяется к сети как сетчатое устройство, его AME может инициировать функции сетки, которые устройство может выполнять после присоединения к сети. Основные функции сетки включают ретрансляцию одноадресных, многоадресных и широковещательных кадров данных для других устройств и разрешение другим устройствам присоединяться к сети через него. AME делает это, выдавая запрос MHME-START-DEVICE.request на сетчатый подуровень. Сетевой подуровень, в свою очередь, выдаст примитив MLME-START.request на MAC-уровень, чтобы запустить устройство как сетчатое устройство. Если полученный примитив MLME-START.confirm возвращает положительное значение, это означает, что устройство успешно стало сетчатым устройством и может выполнять функции, связанные с сетчатым устройством. Сетевой подуровень должен выдать примитив MHME-START-DEVICE.confirm на AME независимо от результатов примитива MLME-START.confirm.

Если устройство присоединяется к сети как конечное устройство, оно может начать выполнять свою задачу после передачи примитива MHME-JOIN.confirm в AME.

Подробную информацию о процессе присоединения и инициирования можно найти в разделах 5.2.2.1, 5.2.2.5 и 5.2.2.7.

##### Назначение адреса

Привязывая логические адреса к топологии сети, маршрутизация может осуществляться без прохождения через обнаружение маршрута. Назначение адреса разбито на два этапа: ассоциация, как описано в 5.5.2 и 5.5.3.1, и назначение адреса, как описано в 5.5.3.2.

На этапе ассоциации, начиная с корня, устройства постепенно присоединяются к сети, и формируется дерево. Но это дерево пока не является логическим, поскольку ни одному устройству не назначен адрес. Ограничений на уровне сетки на количество дочерних элементов, которые может иметь устройство, нет. Устройство должно самостоятельно определять, сколько устройств (следовательно, сколько ветвей) оно должно принять в соответствии со своими возможностями и другими факторами. Обратите внимание, что на этом этапе сеть не функционирует, т. е. никакие данные не могут передаваться с одного устройства на другое.

После того, как ветвь достигнет своего дна, то есть больше нет устройств, ожидающих присоединения к сети (для этой цели можно использовать подходящий таймер meshChildNbReportTime), необходимо использовать процедуру «снизу вверх» для расчета количества устройств вдоль каждой ветви, как показано на рисунке 38. Числа в квадратных скобках указывают количество устройств в ветвях ниже определенного устройства.

![Рисунок 38 — Расчет количества устройств по каждой ветви](/images/Figure%2038%20—Calculation%20of%20number%20of%20devices%20along%20each%20branch%20.png)

Чтобы сообщить о количестве потомков, каждое устройство должно действовать следующим образом. Всякий раз, когда устройство присоединяется к сети, оно должно запустить таймер. Длительность таймера определяется атрибутом MeshIB meshChildNbReportTime, как описано в Таблице 42. Устройство становится листовым устройством, если к нему не присоединятся другие устройства до истечения таймера. Листовое устройство должно немедленно отправить кадр отчета о количестве потомков своему родителю, как описано в 5.3.2.2.1, установив поле количества потомков на единицу, а поле количества запрошенных адресов на значение, равное единице, или большее единицы, если оно хочет зарезервировать некоторые адреса для возможного использования в будущем. Когда нелистовое устройство получает кадр отчета о количестве потомков, оно должно записать количество потомков и количество запрошенных адресов для этой ветви, а затем проверить, сообщил ли каждый из его потомков количество потомков. Если каждый из его потомков сообщил количество потомков, оно должно сообщить количество потомков своему родителю. Поле количества потомков должно быть установлено на количество устройств вдоль его ветви, включая его самого. Поле количества запрошенных адресов должно быть установлено равным сумме количества запрошенных адресов, полученных от всех дочерних элементов, плюс единица или некоторое значение больше единицы, если устройство также хочет зарезервировать некоторые адреса.

Любое устройство может обновить количество дочерних элементов и/или количество запрошенных адресов, передав другой кадр отчета о количестве дочерних элементов своему родителю, если ему не был назначен блок адресов. Например, если конечное устройство становится неконечным устройством, оно должно немедленно отправить другой кадр отчета о количестве дочерних элементов, чтобы обновить своего родителя. Когда неконечное устройство получает кадр отчета о количестве дочерних элементов и если оно уже сообщило количество дочерних элементов, оно должно немедленно обновить своего родителя. Если неконечное устройство не сообщило количество дочерних элементов своему родителю, полученный кадр отчета о количестве дочерних элементов должен обрабатываться как обычно. Если устройство получает кадр отчета о количестве дочерних элементов и ему уже был назначен блок адресов, оно не должно обновлять своего родителя, передавая другой кадр отчета о количестве дочерних элементов. Вместо этого оно должно скорректировать назначение адреса, как описано ниже.

После того, как корень получит информацию от всех ветвей, он должен начать назначать адреса. На этапе назначения адресов используется процедура сверху вниз. Сначала корень проверяет, меньше ли общее количество устройств в сети общего количества доступных адресов. Если нет, назначение адреса не удается. Затем корень назначает блок последовательных адресов каждой ветви ниже себя, принимая во внимание количество потомков и количество запрошенных адресов. Блок адресов, назначенный каждой ветви, указывается начальным полем адреса и конечным полем адреса, указанным в кадре назначения адреса, отправленном каждой ветви, как описано в 5.3.2.2.2. Фактическое количество назначенных адресов может быть меньше или больше количества запрошенных адресов, но не должно быть меньше количества потомков, в зависимости от доступности адресов. Эта процедура продолжается до нижней части дерева. После назначения адреса формируется логическое дерево, и каждое устройство заполняет список соседей для отслеживания ветвей ниже себя. Например, устройство C на рисунке 38 может иметь список соседей, как показано в таблице 45 (не все поля показаны). Обратите внимание, что begAddr каждой записи представляет адрес односкачкового дочернего устройства. Значения полей Link Quality и Reliable Broadcast будут объяснены в соответствующих подпунктах ниже.

**Таблица 45 — Список соседей устройства C после назначения адреса**

| Начальный адрес | Конечный адрес | Уровень дерева | Качество связи | Отношение | Надежная трансляция | Количество прыжков | ... |
| --------------- | -------------- | -------------- | -------------- | --------- | ------------------- | ------------------ | --- |
| 6 (Device D)    | 8              | 3              | 188            | child     | TRUE                | 1                  | ... |
| 9 (Device E)    | 13             | 3              | 148            | child     | TRUE                | 1                  | ... |
| 14 (Device G)   | 14             | 3              | 111            | child     | TRUE                | 1                  | ... |
| ...             | ...            | ...            | ...            | ...       | ...                 | ...                | ... |

Вышеуказанный сосед указывает, что устройство C имеет всего три ветви; устройство D владеет адресным блоком [6, 7, 8] со своим собственным адресом, равным 6; устройство E владеет адресным блоком [9, 10, 11, 12, 13] со своим собственным адресом, равным 9; а устройство G владеет только одним адресом, 14, который является его собственным адресом.

Больше устройств (следовательно, больше ветвей) по-прежнему разрешено добавлять на любом уровне дерева после назначения адреса, если доступны дополнительные адреса (зарезервированные во время назначения адреса). Назначение адреса может быть локально скорректировано в пределах ветви, если у устройства заканчиваются адреса. Например, устройство может запросить больше адресов у своего родителя. Если у родителя недостаточно адресов, оно может либо запросить дополнительные адреса у своего родителя, либо скорректировать назначение адреса среди своих дочерних устройств. Если происходит существенное изменение номера устройства или топологии сети, которое не может быть обработано локально, сети разрешается снова пройти процедуру назначения адреса. На практике назначение адреса контролируется профилем приложения. Например, профиль приложения, используемый для управления освещением, может указывать, что больше адресов должно быть зарезервировано для некоторых специальных устройств, таких как те, что находятся около коридоров. Это улучшает использование адресов и снижает вероятность повторного назначения адреса по мере развития сети. Интеллектуальность распределения ограниченных адресов среди всех сетевых устройств рассматривается за рамками этого документа.

##### Открытие и формирование топологии сетки

После того, как устройству был назначен блок адреса, оно должно транслировать несколько кадров команд hello своим соседям, при этом поле времени жизни (TTL) каждого кадра hello установлено на meshTTLOfHello, как определено в Таблице 42. Обмениваясь кадрами команд hello, каждое устройство создаст таблицу состояния связи (LST) для всех своих соседей в пределах переходов meshTTLOfHello, как определено в Таблице 42. Блок адреса каждого соседа регистрируется в LST, так что вся ветвь ниже соседа является маршрутизируемой. На Рисунке 39 показано представление состояния связи с двумя переходами для Устройства J. Обратите внимание, что Устройства D, E, F, M и N не находятся в пределах 2 переходов от Устройства J, но они по-прежнему напрямую маршрутизируемы, поскольку являются дочерними устройствами этих устройств в пределах 2 переходов от Устройства J.

Таблица состояний каналов устройства, состоящая из списка соседних узлов meshTTLOfHello-hop и матрицы связности, обновляется при получении каждого кадра команды hello.

![Рисунок 39 — Пример — состояние соединения с двумя переходами (вид с устройства J)](/images/Figure%2039%20—An%20example%20–%20two-Hop%20link%20state%20(view%20from%20Device%20J)%20.png)

Каждое устройство должно обновить свой список соседей, как показано в Таблице 46, после получения каждого кадра команды hello. Не только источник кадра команды hello должен быть добавлен в список соседей, но также и соседи источника с одним переходом должны быть добавлены в список соседей, если только TTL во входящем кадре команды hello не равен единице. Для записей, соответствующих соседям источника с одним переходом, поля Ending Address и Tree Level не могут быть заполнены из входящего кадра команды hello и должны быть временно помечены как «неизвестные». Поля Ending Address и Tree Level «неизвестные» будут заменены фактическими значениями при получении кадра команды hello от соответствующего соседа. Если кадр команды hello не получен от некоторых соседей в течение всей процедуры обмена кадрами команды hello, устройство может запросить информацию Ending Address и Tree Level, передав кадр запроса информации о соседе, как описано в 5.3.2.2.4, своим соседям с одним переходом, включая всех соседей, у которых отсутствуют Ending Address и Tree Level. Каждый односкачковый сосед, получивший сообщение, должен ответить, передав обратно кадр ответа с информацией о соседе, как описано в пункте 5.3.2.2.5, если он может предоставить конечный адрес и информацию об уровне дерева одного или нескольких соседей, включенных в кадр запроса информации о соседе.

**Таблица 46 — Список соседей**

| Имя                | Тип              | Допустимый диапазон                                                     | Описание                                                                                                                                                            |
| ------------------ | ---------------- | ----------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| Beginning Address  | Integer          | 0x0000–0xfffe                                                           | Начальный адрес блока адресов, назначенного данному соседу. Он же является адресом данного соседа.                                                                  |
| Ending Address     | Integer          | 0x0000–0xfffe                                                           | Конечный адрес блока адресов, назначенного данному соседу.                                                                                                          |
| Tree Level         | Integer          | 0x00–0xff                                                               | Уровень дерева этого соседа                                                                                                                                         |
| Link Quality       | Integer          | 0x00–0xff                                                               | Качество связи от соседа к данному устройству. Измеряется при получении кадров данных от соседа и находится в диапазоне от 0 (самое низкое) до 255 (самое высокое). |
| Relationship       | Enumeration      | PARENT, CHILD, SIBLING DEVICE, SYNC-PARENT, SYNC-CHILD, NO_RELATIONSHIP | Связь между этим устройством и соседом.                                                                                                                             |
| Reliable Broadcast | Boolean          | TRUE, FALSE                                                             | В этом поле указывается, поддерживает ли соседнее устройство надежную трансляцию.                                                                                   |
| Status             | Enumeration      | UNKNOWN, DOWN, LEFT                                                     | Статус этого соседа.                                                                                                                                                |
| Number of Hops     | Integer          | 0x01–0xff                                                               | Расстояние перехода между данным устройством и соседом. Рассчитывается с использованием матрицы связности, описанной в следующем подпункте.                         |
| Group Membership   | List of Integers | variable                                                                | Список групп многоадресной рассылки, в которых участвует сосед.                                                                                                     |










![Рисунок 40 — Блок-схема func_nextHop(dst)](/images/Figure%2040%20—Flow%20chart%20of%20func_nextHop(dst)%20.png)

![Рисунок 41 — Блок-схема getOneHopNeighbor(neighbor_found)](/images/Figure%2041%20—%20Flow%20chart%20of%20getOneHopNeighbor(neighbor_found)%20.png)

![Рисунок 42 — Сущности протокола многоадресной передачи](/images/Figure%2042%20—Entities%20of%20multicast%20protocol%20.png)

![Рисунок 43 — Блок-схема процесса присоединения](/images/Figure%2043%20—%20Flow%20chart%20of%20the%20joining%20process%20.png)

![Рисунок 44 — Присоединяйтесь как координатор группы](/images/Figure%2044%20—%20Join%20as%20the%20group%20coordinator%20.png)

![Рисунок 45 — Пример присоединения — участники существуют в списке соседей](/images/Figure%2045%20—%20Joining%20example%20–%20members%20exist%20in%20the%20neighbor%20list.png)

![Рисунок 46 — Пример присоединения — адрес GC известен](/images/Figure%2046%20—%20Joining%20example%20–%20the%20GC’s%20address%20is%20known.png)

![Рисунок 47 — Пример присоединения — адрес GC неизвестен](/images/Figure%2047%20—%20Joining%20example%20–%20the%20GC’s%20address%20is%20unknown.png)

![Рисунок 48 — Использование кадра данных для подтверждения](/images/Figure%2048%20—%20Use%20of%20data%20frame%20for%20acknowledgement%20.png)

![Рисунок 49 — Временная структура для ASES](/images/Figure%2049%20—%20Time%20structure%20for%20ASES.png)

![Рисунок 50 — Примеры одноадресной передачи ASES — Устройство B передает кадр устройству A](/images/Figure%2050%20—Examples%20of%20ASES%20unicast%20–%20Dev%20B%20transmits%20a%20frame%20to%20Dev%20A%20.png)

![Рисунок 51 — Диаграмма последовательности сообщений для одноадресной передачи ASES](/images/Figure%2051%20—Message%20sequence%20chart%20for%20ASES%20unicast%20.png)

![Рисунок 52 — Пример трансляции ASES – Dev C транслирует кадр](/images/Figure%2052%20—Example%20of%20ASES%20broadcast%20–%20Dev%20C%20broadcast%20a%20frame%20.png)

![Рисунок 53 — Диаграмма последовательности сообщений для трансляции ASES](/images/Figure%2053%20—Message%20sequence%20chart%20for%20ASES%20broadcast%20.png)

![Рисунок 54 — Временная структура SES](/images/Figure%2054%20—Time%20structure%20of%20SES%20.png)
